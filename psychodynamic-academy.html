<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSYCHODYNAMIC ACADEMY</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
        }
        
        body {
            font-family: 'Press Start 2P', cursive;
            background: #000;
            color: #0f0;
            overflow-x: hidden;
        }
        
        .game-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .game-container {
            width: 100%;
            max-width: 900px;
            background: #222;
            border: 8px solid #0f0;
            box-shadow: 0 0 40px rgba(0, 255, 0, 0.5);
            position: relative;
        }
        
        .crt-effect {
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            z-index: 1000;
        }
        
        .screen {
            background: #000;
            padding: 20px;
            min-height: 600px;
        }
        
        .title {
            text-align: center;
            font-size: 18px;
            color: #0ff;
            text-shadow: 2px 2px #f0f;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            font-size: 8px;
            color: #ff0;
            margin-bottom: 20px;
        }
        
        .progress-header {
            background: #111;
            border: 4px solid #0f0;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .xp-bar-container {
            background: #333;
            border: 2px solid #0f0;
            height: 20px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .xp-bar-fill {
            background: linear-gradient(90deg, #0f0 0%, #0ff 100%);
            height: 100%;
            transition: width 0.5s;
        }
        
        .xp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8px;
            color: #fff;
            text-shadow: 1px 1px #000;
        }
        
        .stats-row {
            display: flex;
            justify-content: space-around;
            font-size: 8px;
        }
        
        .stat-item {
            color: #0ff;
        }
        
        .stat-value {
            color: #ff0;
        }
        
        .skill-tree {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .skill-node {
            background: #001a00;
            border: 4px solid #333;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            min-height: 120px;
        }
        
        .skill-node.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .skill-node.unlocked {
            border-color: #0f0;
        }
        
        .skill-node.unlocked:hover {
            background: #003300;
            transform: translateY(-3px);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }
        
        .skill-node.completed {
            border-color: #ff0;
            background: #1a1a00;
        }
        
        .skill-icon {
            font-size: 32px;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .skill-title {
            font-size: 8px;
            color: #0f0;
            text-align: center;
            margin-bottom: 8px;
        }
        
        .skill-progress {
            font-size: 7px;
            color: #0ff;
            text-align: center;
        }
        
        .skill-lock {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            overflow-y: auto;
        }
        
        .modal.active {
            display: block;
        }
        
        .modal-content {
            background: #000;
            border: 8px solid #0f0;
            padding: 20px;
            max-width: 700px;
            margin: 20px auto;
        }
        
        .lesson-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .lesson-title {
            font-size: 14px;
            color: #0ff;
            margin-bottom: 10px;
        }
        
        .lesson-subtitle {
            font-size: 8px;
            color: #ff0;
        }
        
        .teaching-section {
            background: #001a00;
            border: 2px solid #0f0;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .teaching-text {
            font-size: 9px;
            line-height: 1.8;
            color: #0f0;
            margin-bottom: 15px;
        }
        
        .key-concept {
            background: #000;
            border-left: 4px solid #ff0;
            padding: 10px;
            margin: 15px 0;
        }
        
        .concept-title {
            color: #ff0;
            font-size: 8px;
            margin-bottom: 8px;
        }
        
        .concept-text {
            color: #0f0;
            font-size: 8px;
            line-height: 1.6;
        }
        
        .question-section {
            background: #000;
            border: 4px solid #0f0;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .question-text {
            font-size: 10px;
            color: #0ff;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .answers {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .answer-btn {
            background: #003300;
            border: 4px solid #0f0;
            color: #0f0;
            padding: 15px;
            font-family: 'Press Start 2P', cursive;
            font-size: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        
        .answer-btn:hover:not(.disabled) {
            background: #005500;
            border-color: #0ff;
            transform: translateX(5px);
        }
        
        .answer-btn.correct {
            background: #003300;
            border-color: #0f0;
            animation: correctPulse 0.5s;
        }
        
        .answer-btn.incorrect {
            background: #330000;
            border-color: #f00;
            animation: shake 0.5s;
        }
        
        .answer-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .feedback {
            margin-top: 15px;
            padding: 15px;
            border: 2px solid #0f0;
            font-size: 8px;
            line-height: 1.6;
            display: none;
        }
        
        .feedback.correct {
            background: #001a00;
            border-color: #0f0;
            color: #0f0;
            display: block;
        }
        
        .feedback.incorrect {
            background: #1a0000;
            border-color: #f00;
            color: #f00;
            display: block;
        }
        
        .continue-btn {
            background: #003300;
            border: 4px solid #0f0;
            color: #0f0;
            padding: 12px 30px;
            font-family: 'Press Start 2P', cursive;
            font-size: 9px;
            cursor: pointer;
            margin-top: 20px;
            float: right;
        }
        
        .continue-btn:hover {
            background: #005500;
            border-color: #ff0;
            color: #ff0;
        }
        
        .back-btn {
            background: #330000;
            border: 4px solid #f00;
            color: #f00;
            padding: 10px 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 8px;
            cursor: pointer;
            float: left;
        }
        
        .back-btn:hover {
            background: #550000;
            color: #ff0;
        }
        
        .completion-screen {
            text-align: center;
            padding: 40px 20px;
        }
        
        .completion-icon {
            font-size: 64px;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .completion-title {
            font-size: 16px;
            color: #0f0;
            margin-bottom: 20px;
        }
        
        .xp-earned {
            font-size: 12px;
            color: #ff0;
            margin-bottom: 30px;
        }
        
        .scenario-section {
            background: #001a00;
            border: 2px solid #0ff;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .scenario-title {
            color: #0ff;
            font-size: 9px;
            margin-bottom: 10px;
        }
        
        .scenario-text {
            color: #0f0;
            font-size: 8px;
            line-height: 1.8;
            font-style: italic;
        }

        .level-indicator {
            background: #000;
            border: 2px solid #ff0;
            padding: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .level-text {
            color: #ff0;
            font-size: 10px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .nav-btn {
            flex: 1;
            background: #003300;
            border: 4px solid #0f0;
            color: #0f0;
            padding: 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 8px;
            cursor: pointer;
        }

        .nav-btn:hover {
            background: #005500;
            border-color: #ff0;
            color: #ff0;
        }

        .home-btn {
            background: #001a1a;
            border-color: #0ff;
            color: #0ff;
        }

        .home-btn:hover {
            background: #003333;
            border-color: #f0f;
            color: #f0f;
        }

        /* Keyboard focus improvements */
        .skill-node:focus {
            outline: 3px solid #ff0;
            outline-offset: 3px;
        }

        .answer-btn:focus,
        .continue-btn:focus,
        .back-btn:focus,
        .nav-btn:focus {
            outline: 2px solid #ff0;
            outline-offset: 2px;
        }

        /* Skill prerequisites tooltip */
        .skill-prereq {
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 6px;
            color: #666;
            text-align: center;
        }

        .skill-node.locked .skill-prereq {
            color: #f00;
        }

        /* Running score display */
        .score-tracker {
            background: #001a00;
            border: 2px solid #0f0;
            padding: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 8px;
            color: #0ff;
        }

        .score-value {
            color: #ff0;
            font-size: 10px;
        }

        /* Next skill button */
        .next-skill-btn {
            background: #003300;
            border: 4px solid #0f0;
            color: #0f0;
            padding: 12px 30px;
            font-family: 'Press Start 2P', cursive;
            font-size: 9px;
            cursor: pointer;
            margin-top: 20px;
            animation: pulse 2s infinite;
        }

        .next-skill-btn:hover {
            background: #005500;
            border-color: #ff0;
            color: #ff0;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div class="game-container">
            <div class="crt-effect"></div>
            <div class="screen">
                <div class="title">‚ö° PSYCHODYNAMIC ACADEMY ‚ö°</div>
                <div class="subtitle">FROM NOVICE TO EXPERT</div>
                
                <div class="progress-header">
                    <div class="xp-bar-container">
                        <div class="xp-bar-fill" id="xp-bar"></div>
                        <div class="xp-text" id="xp-text">0 / 100 XP</div>
                    </div>
                    <div class="stats-row">
                        <div class="stat-item">LEVEL: <span class="stat-value" id="level-display">1</span></div>
                        <div class="stat-item">MASTERY: <span class="stat-value" id="mastery-display">0%</span></div>
                        <div class="stat-item">STREAK: <span class="stat-value" id="streak-display">0üî•</span></div>
                    </div>
                </div>

                <div class="level-indicator">
                    <div class="level-text">CURRENT PATH: <span id="current-path">FOUNDATIONS</span></div>
                </div>

                <div class="button-group">
                    <button class="nav-btn home-btn" onclick="window.location.href='learning-library-hub.html'">üè† HOME</button>
                    <button class="nav-btn" onclick="saveProgress()">üíæ SAVE</button>
                    <button class="nav-btn" onclick="loadProgress()">üìÅ LOAD</button>
                    <button class="nav-btn" onclick="resetProgress()">üîÑ RESET</button>
                </div>
                
                <div style="text-align: center; font-size: 6px; color: #666; margin-bottom: 15px;">
                    ‚å®Ô∏è SHORTCUTS: ESC=close ‚Ä¢ H=home ‚Ä¢ S=save ‚Ä¢ TAB=navigate
                </div>
                
                <div class="skill-tree" id="skill-tree"></div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="modal">
        <div class="modal-content" id="modal-content"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        let gameState = {
            level: 1,
            xp: 0,
            xpToNextLevel: 100,
            totalXp: 0,
            streak: 0,
            completedSkills: [],
            skillProgress: {},
            currentLesson: null,
            currentQuestion: 0,
            correctAnswers: 0
        };

        const skillTree = [
            // LEVEL 1: FOUNDATIONS
            {
                id: 'unconscious-intro',
                title: 'The Unconscious',
                icon: 'üß†',
                level: 1,
                xp: 20,
                prereq: null,
                lessons: [
                    {
                        title: 'What is the Unconscious?',
                        teaching: `The UNCONSCIOUS is the foundation of psychodynamic theory. Freud's revolutionary insight: most mental life happens OUTSIDE conscious awareness.

Think of mind like an iceberg. Tiny tip above water = consciousness (what you're aware of right now). Massive bulk below = unconscious (memories, desires, conflicts, fears you don't know you have).

The unconscious isn't just "forgotten" - it's ACTIVELY KEPT from awareness because it's threatening, shameful, or painful. Yet it DRIVES behavior.`,
                        concepts: [
                            {
                                title: 'Three Levels of Mind',
                                text: 'CONSCIOUS: What you\'re aware of now. PRECONSCIOUS: Can be accessed with effort (memories you can recall). UNCONSCIOUS: Cannot be directly accessed - only visible through dreams, slips, symptoms, therapy.'
                            },
                            {
                                title: 'Dynamic Unconscious',
                                text: 'Not passive storage - ACTIVE forces pushing against awareness. Desires, conflicts, traumatic memories exert pressure. They leak out in disguised forms.'
                            }
                        ],
                        questions: [
                            {
                                question: 'A client keeps "forgetting" therapy appointments. They say they want help but miss sessions. From psychodynamic view, what\'s likely happening?',
                                answers: [
                                    { text: 'They have bad time management skills', correct: false, feedback: 'Too surface-level. Psychodynamic thinking looks DEEPER - what unconscious conflict might "forgetting" express?' },
                                    { text: 'Unconscious resistance - part of them fears what therapy might uncover', correct: true, feedback: 'Exactly! Forgetting is rarely just forgetting. It can be unconscious DEFENSE against threatening material. The behavior (missing) contradicts stated wish (wanting help) - classic sign of unconscious conflict.' },
                                    { text: 'They don\'t actually need therapy', correct: false, feedback: 'This dismisses their stated need. Psychodynamic view: behavior often contradicts conscious wishes because unconscious has different agenda.' },
                                    { text: 'They need medication, not talk therapy', correct: false, feedback: 'This bypasses the psychological meaning. Psychodynamic approach asks: what is the symptom (forgetting) COMMUNICATING?' }
                                ]
                            },
                            {
                                question: 'Why can\'t people just "decide" to access their unconscious directly?',
                                answers: [
                                    { text: 'The unconscious is protected by defense mechanisms that keep threatening material out of awareness', correct: true, feedback: 'YES! Defenses exist precisely to PREVENT direct access. If unconscious material could be easily accessed, it wouldn\'t be unconscious. Therapy works to gradually bypass defenses.' },
                                    { text: 'People are lazy or unmotivated', correct: false, feedback: 'This misses the DYNAMIC aspect. It\'s not willpower - unconscious is actively BARRED from awareness by psychological forces.' },
                                    { text: 'The unconscious doesn\'t actually exist', correct: false, feedback: 'Psychodynamic theory is built on the unconscious. Even if you question the model, the clinical phenomena (slips, dreams, symptoms) suggest processes outside awareness.' },
                                    { text: 'Only therapists can access the unconscious', correct: false, feedback: 'Anyone can access unconscious material (dreams, free association, slips). But DEFENSES make this difficult. Therapist helps, but doesn\'t have special power.' }
                                ]
                            },
                            {
                                question: 'Client says: "I had a dream I was late to my wedding, but I wasn\'t upset." What might this reveal about unconscious feelings toward commitment?',
                                answers: [
                                    { text: 'Nothing - dreams are random and meaningless', correct: false, feedback: 'Psychodynamic view: dreams are "royal road to unconscious" - they express disguised wishes and conflicts.' },
                                    { text: 'Possible unconscious ambivalence about commitment - lateness suggests avoidance, lack of upset suggests acceptance of this', correct: true, feedback: 'Strong interpretation! Being late (missing/avoiding) + not upset = unconscious comfort with NOT committing. Dreams often express what consciousness denies.' },
                                    { text: 'They definitely should not get married', correct: false, feedback: 'Dreams inform, they don\'t dictate. This would be over-interpreting. Use dream as EXPLORATION point, not directive.' },
                                    { text: 'They just need better time management', correct: false, feedback: 'This ignores symbolic meaning. Psychodynamic approach: manifest content (being late) often symbolizes latent content (conflict about commitment).' }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                id: 'defense-mechanisms',
                title: 'Defense Mechanisms',
                icon: 'üõ°Ô∏è',
                level: 1,
                xp: 25,
                prereq: 'unconscious-intro',
                lessons: [
                    {
                        title: 'How the Mind Protects Itself',
                        teaching: `DEFENSE MECHANISMS are unconscious psychological strategies that protect ego from anxiety, guilt, shame, and other threatening feelings.

Key insight: Defenses are NORMAL and necessary. Without them, we'd be overwhelmed by every painful reality. They become problematic when: overused, rigid, prevent growth, or cause more suffering than they prevent.

Defenses operate UNCONSCIOUSLY - client isn't aware they're doing it. Your job: recognize patterns, understand function, gently help client become aware.`,
                        concepts: [
                            {
                                title: 'Mature vs Immature Defenses',
                                text: 'MATURE: Humor, sublimation, suppression - adaptive, flexible. IMMATURE: Denial, projection, splitting - rigid, distort reality more severely. Development moves toward more mature defenses.'
                            },
                            {
                                title: 'Function of Defenses',
                                text: 'Defenses serve a PURPOSE - protect from overwhelming affect. Don\'t attack defenses directly. Respect them. Explore: "What would happen if you let yourself feel that fully?" Build tolerance first.'
                            }
                        ],
                        questions: [
                            {
                                question: 'Client describes abusive father as "stern but fair" and minimizes severity. Which defense?',
                                answers: [
                                    { text: 'Projection', correct: false, feedback: 'Projection is attributing YOUR feeling to someone else. Not happening here.' },
                                    { text: 'Rationalization', correct: false, feedback: 'Close! But rationalization is more about justifying behavior. This is more about minimizing reality...' },
                                    { text: 'Denial', correct: true, feedback: 'YES. Denial refuses to acknowledge painful reality. "Stern but fair" rewrites abusive as acceptable. Protects from grief/rage about having abusive father.' },
                                    { text: 'Displacement', correct: false, feedback: 'Displacement redirects feelings to safer target (yelling at partner instead of boss). Not this scenario.' }
                                ]
                            },
                            {
                                question: 'Client is furious at you but accuses YOU of being angry at THEM. What defense is this?',
                                answers: [
                                    { text: 'Projection', correct: true, feedback: 'EXACTLY! Projection: attributing unacceptable feeling to someone else. Client can\'t tolerate own anger, so "sees" it in you instead. This is KEY to recognize in therapy!' },
                                    { text: 'Reaction formation', correct: false, feedback: 'Reaction formation is acting OPPOSITE of true feeling (being overly nice when angry). Not quite this.' },
                                    { text: 'Intellectualization', correct: false, feedback: 'Intellectualization is avoiding feeling by over-thinking. Not this scenario.' },
                                    { text: 'Regression', correct: false, feedback: 'Regression is reverting to earlier developmental stage under stress. Not what\'s happening.' }
                                ]
                            },
                            {
                                question: 'What\'s the most therapeutic response when you notice a defense?',
                                answers: [
                                    { text: '"You\'re using denial!" - confront it directly', correct: false, feedback: 'Too confrontational. Defenses exist for PROTECTION. Direct attack increases defensiveness.' },
                                    { text: 'Ignore it and move on', correct: false, feedback: 'Defenses are clinically important! They reveal what\'s threatening. Don\'t ignore.' },
                                    { text: 'Get curious about what the defense protects against', correct: true, feedback: 'PERFECT. "I notice when we talk about your dad, the conversation becomes lighter. I wonder what might be hard to feel if we stayed with it?" Respect defense, explore function.' },
                                    { text: 'Tell them they need to stop defending', correct: false, feedback: 'Can\'t just stop defending without building capacity to tolerate the feeling beneath. You\'d overwhelm them.' }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                id: 'transference-basics',
                title: 'Transference 101',
                icon: 'üîÑ',
                level: 1,
                xp: 30,
                prereq: 'defense-mechanisms',
                lessons: [
                    {
                        title: 'Understanding Transference',
                        teaching: `TRANSFERENCE: Client unconsciously relates to you as if you were significant figure from their past (parent, sibling, teacher, ex). They PROJECT old relationship template onto therapeutic relationship.

This isn't about YOU - it's about THEM. Their psyche uses you as screen to project unresolved relational patterns.

Why it matters: Transference is INFORMATION about client's internal world and relational patterns. It's also the VEHICLE for change - when you respond differently than the original figure, healing happens.`,
                        concepts: [
                            {
                                title: 'Positive vs Negative Transference',
                                text: 'POSITIVE: Idealizing you, seeking approval, compliance. NEGATIVE: Mistrust, anger, rebellion, seeing you as critical. BOTH are important clinical material. Don\'t take personally.'
                            },
                            {
                                title: 'Working with Transference',
                                text: 'Don\'t interpret too early (feels like accusation). Wait for pattern. Then: "I notice you often seem to seek my approval. I\'m curious if this feels familiar from other relationships?" Links present to past.'
                            }
                        ],
                        questions: [
                            {
                                question: 'Client constantly apologizes for "taking up your time" and asks "Is this okay to talk about?" What transference might this indicate?',
                                answers: [
                                    { text: 'They had caregivers who made them feel burdensome or unwelcome', correct: true, feedback: 'EXCELLENT reading! Excessive apologizing + permission-seeking suggests internalized message: "My needs are too much." They expect you\'ll be annoyed like early caregivers were. This is transference of that dynamic.' },
                                    { text: 'They are just very polite', correct: false, feedback: 'Too surface. PATTERN of apologizing (not once, but constantly) suggests deeper relational template, not just manners.' },
                                    { text: 'They don\'t trust you yet', correct: false, feedback: 'Trust is related, but this misses the PAST origin. It\'s not about you - it\'s them relating to you AS IF you\'re someone from past who punished neediness.' },
                                    { text: 'They have generalized anxiety disorder', correct: false, feedback: 'Anxiety might be present, but this explanation misses the RELATIONAL pattern. Psychodynamic thinking looks at interpersonal dynamics.' }
                                ]
                            },
                            {
                                question: 'Client seems angry when you take vacation. They say "Whatever, I don\'t care." How do you understand this?',
                                answers: [
                                    { text: 'They genuinely don\'t care', correct: false, feedback: 'The DISCONNECT between words ("don\'t care") and affect (anger) suggests defense. Psychodynamic rule: when words and feeling don\'t match, trust the feeling.' },
                                    { text: 'Transference of abandonment - your leaving activates old wounds, defended against with dismissal', correct: true, feedback: 'YES! "I don\'t care" is defense against pain of being left. Likely pattern from childhood: caregiver was unreliable, client learned to deny need to protect from disappointment. You leaving reactivates this.' },
                                    { text: 'They need a different therapist', correct: false, feedback: 'This reaction is RICH clinical material! Don\'t run from transference - explore it. This is where healing happens.' },
                                    { text: 'You should cancel your vacation', correct: false, feedback: 'No! Boundaries are essential. Your vacation isn\'t the problem - it\'s the trigger revealing their struggle with separation and abandonment.' }
                                ]
                            },
                            {
                                question: 'When is the best time to interpret transference?',
                                answers: [
                                    { text: 'Immediately when you notice it', correct: false, feedback: 'Too soon feels accusatory and increases defense. Build alliance first.' },
                                    { text: 'Never - just let it unfold', correct: false, feedback: 'Transference is powerful therapeutic tool! Use it. But with timing and care.' },
                                    { text: 'After pattern repeats and alliance is strong enough', correct: true, feedback: 'EXACTLY. Wait for: 1) Clear pattern (not one-time event), 2) Therapeutic alliance strong enough to tolerate observation, 3) Client has some curiosity. Then gently link present to past.' },
                                    { text: 'Only when client asks about it', correct: false, feedback: 'Client likely won\'t ask - transference is unconscious. Part of therapist role is to NAME patterns client can\'t see.' }
                                ]
                            }
                        ]
                    }
                ]
            },

            // LEVEL 2: INTERMEDIATE
            {
                id: 'countertransference',
                title: 'Countertransference',
                icon: 'ü™û',
                level: 2,
                xp: 35,
                prereq: 'transference-basics',
                lessons: [
                    {
                        title: 'Your Reactions Are Data',
                        teaching: `COUNTERTRANSFERENCE: Your emotional reactions to client. Originally seen as problematic (therapist's unresolved issues), now understood as invaluable CLINICAL INFORMATION.

Two types:
1) SUBJECTIVE: Your personal reaction based on YOUR history (client reminds you of your sister)
2) OBJECTIVE: What client EVOKES in others generally (everyone feels protective, or irritated, or bored)

Both matter! Subjective = know yourself. Objective = understand client's relational impact.`,
                        concepts: [
                            {
                                title: 'Countertransference as Compass',
                                text: 'Your feelings tell you about client\'s inner world. Feel incompetent? Maybe client feels this way and is projecting. Feel protective? Maybe client evokes rescue. Feel angry? Maybe client is holding disowned rage. USE your reactions.'
                            },
                            {
                                title: 'Managing Countertransference',
                                text: 'FEEL it (don\'t suppress), REFLECT on it (supervision, therapy, journaling), DON\'T ACT ON IT (especially: don\'t rescue, retaliate, withdraw, or sexualize). Process, then use clinically.'
                            }
                        ],
                        questions: [
                            {
                                question: 'You feel increasingly irritated with a client who seems helpless and wants you to "fix" everything. What does your irritation likely reveal?',
                                answers: [
                                    { text: 'You\'re a bad therapist who shouldn\'t work with this client', correct: false, feedback: 'No! Feelings aren\'t moral failures. They\'re information. Your irritation is DATA.' },
                                    { text: 'The client evokes frustration in relationships - probably a pattern where others feel burdened and pull away', correct: true, feedback: 'BRILLIANT! Your countertransference often mirrors what client experiences elsewhere. If YOU feel irritated by helplessness, others probably do too. This IS the problem client needs help with. Your feeling illuminates their relational pattern.' },
                                    { text: 'The client needs medication, not therapy', correct: false, feedback: 'This avoids the relational information. Your irritation is telling you something about therapeutic dynamic.' },
                                    { text: 'You should tell them to stop being helpless', correct: false, feedback: 'Acting on countertransference (especially with frustration) harms client. PROCESS it, don\'t enact it.' }
                                ]
                            },
                            {
                                question: 'You notice you\'re working extra hard to help a client - staying late, thinking about them constantly, wanting to "save" them. What\'s happening?',
                                answers: [
                                    { text: 'You care deeply and are a dedicated therapist', correct: false, feedback: 'Maybe partly true, but this level of over-functioning suggests something deeper - likely countertransference.' },
                                    { text: 'Rescue fantasy - client may evoke this in others, or this touches YOUR need to be needed', correct: true, feedback: 'YES! Over-functioning is classic countertransference. Ask: Does client evoke rescue (their pattern)? Does this touch MY savior complex (my pattern)? Probably both. Supervision needed!' },
                                    { text: 'This is normal and fine', correct: false, feedback: 'Boundary blurring and over-investment are RED FLAGS. "Normal" care doesn\'t involve staying late and constant preoccupation. This needs examination.' },
                                    { text: 'The client is manipulating you', correct: false, feedback: 'Blaming client misses YOUR role. Countertransference is about examining YOURSELF. Even if client has manipulative patterns, your response is yours to manage.' }
                                ]
                            },
                            {
                                question: 'Best way to handle strong countertransference?',
                                answers: [
                                    { text: 'Ignore it and stay professional', correct: false, feedback: 'Ignoring increases risk of ENACTMENT (unconsciously acting out the feeling). You can\'t suppress away countertransference.' },
                                    { text: 'Tell the client how they make you feel', correct: false, feedback: 'RARELY appropriate! Client isn\'t responsible for managing YOUR reactions. Process in supervision/therapy, not with client.' },
                                    { text: 'Reflect on it in supervision/therapy, understand its source and meaning, then use consciously', correct: true, feedback: 'PERFECT! Process privately, understand (is this about me or them or both?), then use awareness therapeutically. Example: "I notice I want to fix everything for you - I wonder if others in your life feel this pull too?"' },
                                    { text: 'Refer the client to someone else', correct: false, feedback: 'Sometimes necessary if truly unmanageable, but countertransference happens with EVERY client. Running from it means missing its clinical value.' }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                id: 'resistance',
                title: 'Resistance',
                icon: 'üöß',
                level: 2,
                xp: 30,
                prereq: 'countertransference',
                lessons: [
                    {
                        title: 'When Clients Push Back',
                        teaching: `RESISTANCE: Client's (mostly unconscious) opposition to therapeutic process. Shows up as: missed sessions, changing topics, intellectualizing, silence, "yes-but-ing," forgetting insights.

CRUCIAL UNDERSTANDING: Resistance isn't defiance or lack of motivation. It's PROTECTION. Part of client wants to change, part is terrified of what change means.

Resistance signals you're getting close to something important. WELCOME it. "The resistance is the work."`,
                        concepts: [
                            {
                                title: 'Forms of Resistance',
                                text: 'AVOIDANCE (changing subject, lateness). INTELLECTUALIZATION (analyzing feelings instead of feeling them). COMPLIANCE (being "good patient" to avoid real work). HOPELESSNESS ("nothing will help"). TRANSFERENCE RESISTANCE (attachment to you prevents change).'
                            },
                            {
                                title: 'Working with Resistance',
                                text: 'Don\'t fight it or shame it ("You\'re resisting!"). GET CURIOUS: "I notice we keep moving away from this topic. What might be hard about staying with it?" "Part of you wants help, part seems hesitant. Can we talk about the hesitant part?" Honor the protection.'
                            }
                        ],
                        questions: [
                            {
                                question: 'Client intellectualizes every emotion: "I think I feel sad because evolutionarily..." rather than FEELING sadness. What\'s the resistance protecting against?',
                                answers: [
                                    { text: 'They\'re just very smart and analytical', correct: false, feedback: 'Intelligence is real, but using it to AVOID feeling is defense/resistance. Psychodynamic lens: ask WHY now, WHY this way?' },
                                    { text: 'The overwhelming affect beneath the thoughts - staying in head protects from flood of feeling', correct: true, feedback: 'YES! Intellectualization keeps feelings at distance. If they dropped into body and FELT the sadness fully, it might overwhelm. Thinking ABOUT emotion is safer than EXPERIENCING emotion. Your job: build tolerance slowly.' },
                                    { text: 'They don\'t actually have emotions', correct: false, feedback: 'Everyone has emotions. Some are just more defended. The intellectualizing proves there\'s something TO defend against.' },
                                    { text: 'You\'re not smart enough to understand them', correct: false, feedback: 'This might be YOUR countertransference (feeling inadequate). Don\'t take the bait. Their intellectualizing isn\'t about your intelligence.' }
                                ]
                            },
                            {
                                question: 'Client says "I feel so much better! I don\'t think I need therapy anymore" after two sessions where you\'ve barely scratched surface. What\'s likely happening?',
                                answers: [
                                    { text: 'They genuinely are cured', correct: false, feedback: 'After two sessions? Unlikely. Psychodynamic work takes time. Sudden "cure" is usually resistance.' },
                                    { text: 'Flight into health - resistance against going deeper', correct: true, feedback: 'EXACTLY! "Flight into health" is classic resistance. They felt relief (maybe just from being heard), but anxiety about deeper work triggers "I\'m fine now, bye!" Explore: "What might be scary about continuing?"' },
                                    { text: 'You\'re such a good therapist they healed instantly', correct: false, feedback: 'This would be YOUR countertransference (narcissistic wish). Be suspicious of miraculous quick fixes. Usually defense.' },
                                    { text: 'They found a better therapist', correct: false, feedback: 'Maybe, but more likely this is resistance. Explore before accepting at face value.' }
                                ]
                            },
                            {
                                question: 'How do you address resistance without shaming?',
                                answers: [
                                    { text: '"You\'re clearly resisting. Why won\'t you engage?"', correct: false, feedback: 'Confrontational and shaming. Will increase resistance, not reduce it.' },
                                    { text: 'Ignore it and hope they come around', correct: false, feedback: 'Resistance doesn\'t disappear if ignored. It\'s the CORE of the work. Must address.' },
                                    { text: 'Name it gently and get curious about its function: "Part of you seems hesitant. Can we explore what that\'s about?"', correct: true, feedback: 'PERFECT! Non-judgmental, curious, honors that resistance serves PURPOSE. This invites exploration without shame. You\'re allies investigating together, not adversaries.' },
                                    { text: 'Give up and refer them out', correct: false, feedback: 'Resistance is NORMAL in therapy. If you can\'t work with resistance, you can\'t do psychodynamic work. It\'s the territory.' }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                id: 'dreamwork',
                title: 'Dream Analysis',
                icon: 'üí≠',
                level: 2,
                xp: 35,
                prereq: 'resistance',
                lessons: [
                    {
                        title: 'The Royal Road',
                        teaching: `DREAMS are "royal road to unconscious" - Freud's famous phrase. During sleep, defenses relax, unconscious material emerges in DISGUISED form.

MANIFEST CONTENT: Actual events/images of dream (what you remember)
LATENT CONTENT: Hidden meaning, unconscious wish/conflict (what it MEANS)

Dreams use SYMBOLISM, CONDENSATION (multiple meanings in one image), DISPLACEMENT (feeling attached to wrong object). This is dream-work - how unconscious communicates.`,
                        concepts: [
                            {
                                title: 'Working with Dreams',
                                text: 'Don\'t interpret FOR client ("This means..."). EXPLORE WITH them: "What associations do you have to that image?" "How did you feel in the dream?" Let THEM find meaning. You guide.'
                            },
                            {
                                title: 'Common Dream Themes',
                                text: 'Being chased (avoidance), falling (loss of control), being naked (exposure/vulnerability), teeth falling out (powerlessness, loss), taking test unprepared (performance anxiety). But PERSONAL meaning always matters more than universal symbols.'
                            }
                        ],
                        questions: [
                            {
                                question: 'Client dreams their teeth are falling out. They look distressed. What\'s your approach?',
                                answers: [
                                    { text: '"Teeth dreams mean powerlessness. Let\'s explore where you feel powerless."', correct: false, feedback: 'Too directive! You imposed YOUR interpretation. Symbols have PERSONAL meanings. Let client associate first.' },
                                    { text: '"What associations do you have to teeth? What was the feeling in the dream?"', correct: true, feedback: 'EXCELLENT! Start with CLIENT\'S associations. They might link teeth to: appearance, biting/aggression, decay, childhood tooth fairy memories, aging. THEIR meaning matters, not dream dictionary.' },
                                    { text: '"Dreams are just random brain activity, they don\'t mean anything."', correct: false, feedback: 'Psychodynamic theory holds dreams ARE meaningful - disguised expressions of unconscious. Even if you question this, client brought it, so explore.' },
                                    { text: 'Move on to more important topics', correct: false, feedback: 'Client shared dream - this IS important to them. Dreams offer rich material. Don\'t dismiss.' }
                                ]
                            },
                            {
                                question: 'Client reports recurring dream of being in childhood home but all the doors are locked. What might this suggest?',
                                answers: [
                                    { text: 'They need to move to a different house', correct: false, feedback: 'Way too literal! Dreams are SYMBOLIC, not concrete suggestions.' },
                                    { text: 'Feeling trapped in old patterns, unable to access parts of self, blocked emotionally', correct: true, feedback: 'STRONG interpretation! Childhood home = past, origin. Locked doors = blocked access, inability to move through/explore. Recurring = unresolved issue. But remember: verify with client\'s associations!' },
                                    { text: 'They were actually locked in their childhood home', correct: false, feedback: 'Possible but unlikely. Dreams condense and symbolize. Don\'t assume literal truth without exploration.' },
                                    { text: 'Nothing - it\'s just a random dream', correct: false, feedback: 'RECURRING dreams especially signal unresolved conflict. Psyche keeps trying to work it through.' }
                                ]
                            },
                            {
                                question: 'Client insists "I never dream" or "I don\'t remember dreams." What does this suggest?',
                                answers: [
                                    { text: 'They literally don\'t dream', correct: false, feedback: 'Everyone dreams (REM sleep). Not remembering is different from not dreaming.' },
                                    { text: 'Strong repression - unconscious material is heavily defended against', correct: true, feedback: 'YES! Not remembering dreams often signals strong defenses. Unconscious is well-guarded. Some clients begin remembering dreams as therapy progresses and defenses loosen. You can invite: "Keep paper by bed, jot dreams on waking."' },
                                    { text: 'They\'re lying to you', correct: false, feedback: 'Unlikely and unproductive assumption. They truly may not recall. Explores defenses, not deception.' },
                                    { text: 'Dreams aren\'t important for therapy', correct: false, feedback: 'Dreams offer valuable unconscious material when available. But don\'t force. Some clients connect more to other methods (free association, symptoms, slips).' }
                                ]
                            }
                        ]
                    }
                ]
            },

            // LEVEL 3: ADVANCED
            {
                id: 'object-relations',
                title: 'Object Relations',
                icon: 'üë•',
                level: 3,
                xp: 40,
                prereq: 'dreamwork',
                lessons: [
                    {
                        title: 'Internalized Relationships',
                        teaching: `OBJECT RELATIONS THEORY: We internalize early relationships and carry them as templates. "Objects" = mental representations of others (and self in relation to others).

These internal objects form basis for how we relate in present. If mother was critical, you might carry "critical object" internally and either: a) expect others to be critical, b) become critical toward self/others, or c) both.

Key theorists: Melanie Klein, Donald Winnicott, Ronald Fairbairn. Focus shifts from drives (Freud) to relationships (object relations).`,
                        concepts: [
                            {
                                title: 'Good Enough Mothering',
                                text: 'Winnicott: Perfect parenting impossible and unnecessary. "Good enough" - mostly attuned, tolerates baby\'s aggression, allows gradual separation. This builds secure sense of self and others. Too perfect = child can\'t tolerate frustration. Too inconsistent = fragile self.'
                            },
                            {
                                title: 'Splitting',
                                text: 'Klein: Infants split objects into "all good" and "all bad" (can\'t hold complexity). Healthy development integrates: mother is sometimes frustrating AND mostly loving. Arrested development = splitting persists in adulthood (people are saints or villains).'
                            }
                        ],
                        questions: [
                            {
                                question: 'Client idealizes you one session ("You\'re the only one who understands me!") and devalues you the next ("You\'re useless like everyone else"). What object relations concept explains this?',
                                answers: [
                                    { text: 'They have bipolar disorder', correct: false, feedback: 'This is relational pattern, not mood disorder. Extreme shifts in how they see YOU (not mood shifts). Object relations phenomenon.' },
                                    { text: 'Splitting - inability to hold ambivalence, you\'re either all-good or all-bad', correct: true, feedback: 'EXACTLY! Splitting = can\'t integrate that you\'re BOTH helpful AND imperfect. When you frustrate them (inevitable), they flip from idealization to devaluation. Common in borderline dynamics. Your job: stay steady through both, model integration.' },
                                    { text: 'They\'re just very moody', correct: false, feedback: 'Too surface. This is consistent RELATIONAL pattern, not random moodiness. Object relations provides framework.' },
                                    { text: 'They\'re manipulating you', correct: false, feedback: 'Splitting isn\'t manipulation - it\'s developmental arrest. They genuinely FEEL you\'re all-good then all-bad. It\'s how they organize experience.' }
                                ]
                            },
                            {
                                question: 'Client says "I\'m such an idiot, I hate myself" after small mistake. From object relations view, what\'s internalized?',
                                answers: [
                                    { text: 'A harsh, critical internal object (likely based on critical early caregiver)', correct: true, feedback: 'YES! Vicious self-criticism often reflects INTERNALIZED critical parent/caregiver. They relate to SELF the way they were related TO. This critical voice lives inside now. Therapy helps build more compassionate internal object.' },
                                    { text: 'They just have low self-esteem', correct: false, feedback: 'Describes the symptom, doesn\'t explain origin. Object relations asks: WHERE did this harsh self-treatment come from? What relationship is it based on?' },
                                    { text: 'They need positive affirmations', correct: false, feedback: 'Affirmations might help surface-level, but object relations work goes deeper - examining and reworking internalized relationships, not just positive thinking.' },
                                    { text: 'Nothing, they\'re being accurate about themselves', correct: false, feedback: 'The HARSHNESS and totality ("I\'m an idiot" over small mistake) suggests distortion from internalized critical object, not accurate self-assessment.' }
                                ]
                            },
                            {
                                question: 'What\'s the therapeutic goal in object relations work?',
                                answers: [
                                    { text: 'Eliminate all internal objects', correct: false, feedback: 'Impossible and not desirable! We\'ll always have internalized relationships. Can\'t erase them.' },
                                    { text: 'Become aware of internal objects and develop more flexible, integrated representations', correct: true, feedback: 'PERFECT! Goals: 1) Awareness of how you carry early relationships internally, 2) Develop capacity to hold complexity (people are good AND bad), 3) Internalize therapist as new, more attuned object, 4) Relate to self with more compassion.' },
                                    { text: 'Replace bad internal objects with good ones', correct: false, feedback: 'Too simplistic. Integration is goal, not replacement. Learning to hold both good and bad in self and others.' },
                                    { text: 'Go back and change childhood relationships', correct: false, feedback: 'Can\'t change past. Can change how internalized past operates in present. Therapy offers corrective relational experience NOW.' }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                id: 'interpretation',
                title: 'The Art of Interpretation',
                icon: 'üîç',
                level: 3,
                xp: 45,
                prereq: 'object-relations',
                lessons: [
                    {
                        title: 'Making the Unconscious Conscious',
                        teaching: `INTERPRETATION: Therapist's offering of possible unconscious meaning. "I wonder if..." or "It seems like..." rather than "This IS..."

Good interpretation: links present to past, conscious to unconscious, behavior to feeling. Makes connections client couldn't see alone. 

Bad interpretation: imposed, premature, more about therapist showing off than helping client. Remember: interpretation is INVITATION to explore, not declaration of truth.`,
                        concepts: [
                            {
                                title: 'Timing is Everything',
                                text: 'Too early = client rejects (not ready). Too late = client already knows (not useful). Right time = client is ALMOST there, interpretation helps them take last step. Watch for: client circling around idea, defenses softening, alliance strong.'
                            },
                            {
                                title: 'Layers of Interpretation',
                                text: 'Start surface (defense/behavior level), gradually go deeper (underlying feeling, past origins, transference). Don\'t jump to deepest meaning first. Build progressively. Example: First: "You seem to apologize a lot." Later: "I wonder if you expect me to be annoyed with you." Still later: "This reminds me of how you described your mother\'s impatience."'
                            }
                        ],
                        questions: [
                            {
                                question: 'Client describes fight with partner, then immediately changes subject to work stress. How do you interpret?',
                                answers: [
                                    { text: '"You\'re avoiding your relationship issues because you had a narcissistic mother."', correct: false, feedback: 'Way too deep, too fast! Skipped from surface behavior to deep origin. Also too certain ("because"). Client will likely reject this.' },
                                    { text: '"I notice when we started talking about the fight, the topic shifted to work. I\'m curious what might be hard about staying with the relationship conflict."', correct: true, feedback: 'EXCELLENT! Surface-level interpretation: names the DEFENSE (changing subject). Stays curious, not declaring. Invites exploration without going too deep too fast. This is how you build toward deeper work.' },
                                    { text: 'Say nothing and follow their lead to work stress', correct: false, feedback: 'You\'d miss opportunity to explore the avoidance (which is clinically important). Need to gently point out the shift.' },
                                    { text: '"Why are you changing the subject?"', correct: false, feedback: 'Sounds accusatory. Client likely isn\'t consciously aware they\'re changing subject (it\'s unconscious defense). More gentle approach needed.' }
                                ]
                            },
                            {
                                question: 'Client rejects your interpretation: "That\'s not it at all!" What do you do?',
                                answers: [
                                    { text: 'Insist you\'re right - they\'re just resisting', correct: false, feedback: 'NEVER insist. You might be wrong! Or timing might be off. Forcing interpretation damages alliance.' },
                                    { text: '"You\'re right, I may have misunderstood. Can you help me understand it differently?"', correct: true, feedback: 'PERFECT! Humility and collaboration. You don\'t know client better than they know themselves. Strong rejection might mean: you\'re wrong, timing is off, OR you\'re right but too threatening (resistance). Stay curious, back off, try again later if still relevant.' },
                                    { text: 'Feel hurt and withdraw', correct: false, feedback: 'This is YOUR countertransference (narcissistic injury). Don\'t take rejection personally. Process in supervision.' },
                                    { text: 'Change the subject and never interpret again', correct: false, feedback: 'One rejection doesn\'t mean never interpret! Learn from it (what was off?), adjust approach, keep trying. Interpretation is central to psychodynamic work.' }
                                ]
                            },
                            {
                                question: 'Which interpretation is MOST useful?',
                                answers: [
                                    { text: '"You have an Oedipus complex from age 5."', correct: false, feedback: 'Too theoretical, jargony, abstract. Not emotionally resonant or immediately helpful. Classical psychoanalysis might say this, but modern approach focuses on what\'s alive NOW.' },
                                    { text: '"I notice you seem to compete with me sometimes, like you need to prove you\'re smarter. I\'m wondering if this feels familiar from other relationships - maybe with your father who you described as dismissive?"', correct: true, feedback: 'EXCELLENT! This interpretation: 1) Names present pattern (compete with me), 2) Wonders about origin (father), 3) Links past to present, 4) Stays tentative ("wondering"), 5) Uses their own words (father was "dismissive"). Specific, emotionally alive, invites exploration.' },
                                    { text: '"Your unconscious is telling you something."', correct: false, feedback: 'Too vague! What specifically? Good interpretations are SPECIFIC, link concrete behaviors to possible meanings.' },
                                    { text: '"Deep down you know what this means."', correct: false, feedback: 'Unhelpful! If they knew, they wouldn\'t need therapy. Interpretation should offer NEW perspective they couldn\'t access alone.' }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                id: 'working-through',
                title: 'Working Through',
                icon: 'üîÅ',
                level: 3,
                xp: 40,
                prereq: 'interpretation',
                lessons: [
                    {
                        title: 'Repetition and Integration',
                        teaching: `WORKING THROUGH: The long, repetitive middle phase of therapy where insights must be applied again and again to different situations until they become integrated.

Insight alone doesn't heal. Client needs to: recognize pattern in multiple contexts, connect intellectually AND emotionally, practice new responses, tolerate discomfort of change.

This is why therapy takes time. Change is SLOW. Same themes return repeatedly at deeper levels. This isn't failure - it's the process.`,
                        concepts: [
                            {
                                title: 'Spiraling Deeper',
                                text: 'Therapy isn\'t linear progress. Same issue returns but each time you understand it more deeply, from different angle, with more emotional access. Like spiral staircase - passing same point but at deeper level each time.'
                            },
                            {
                                title: 'Therapeutic Action',
                                text: 'Change happens through: 1) INSIGHT (making unconscious conscious), 2) CORRECTIVE EMOTIONAL EXPERIENCE (new relational experience with therapist), 3) WORKING THROUGH (repeated application), 4) INTERNALIZATION (taking in healthier ways of being).'
                            }
                        ],
                        questions: [
                            {
                                question: 'Client says "We\'ve talked about my fear of abandonment so many times. Why isn\'t it fixed yet?" What do you say?',
                                answers: [
                                    { text: '"You\'re not trying hard enough."', correct: false, feedback: 'Shaming and inaccurate! Working through takes TIME. This isn\'t about effort.' },
                                    { text: '"Deep patterns take time to change. Each time we explore it, you understand more deeply and build new capacity. This repetition IS the healing process."', correct: true, feedback: 'PERFECT! Normalize that working through is repetitive by nature. Educate that this isn\'t failure. Pattern built over decades won\'t shift after discussing once. Repeated examination, from multiple angles, with emotional engagement = how change happens.' },
                                    { text: '"Maybe psychodynamic therapy isn\'t right for you."', correct: false, feedback: 'Working through is CENTRAL to psychodynamic work! If you can\'t tolerate repetition and slow change, this modality isn\'t for you (the therapist). Client is doing the work.' },
                                    { text: '"Let\'s just focus on something else."', correct: false, feedback: 'Avoidance! If abandonment fear is core issue and keeps appearing, that\'s because it NEEDS working through. Don\'t run from it.' }
                                ]
                            },
                            {
                                question: 'How do you know working through is happening (vs. stuck in repetition)?',
                                answers: [
                                    { text: 'Client never mentions the issue again', correct: false, feedback: 'Absence of topic might mean avoidance, not resolution. Working through involves REPEATED engagement, not disappearance.' },
                                    { text: 'Client recognizes pattern more quickly, with more affect, and tries new responses (even if imperfectly)', correct: true, feedback: 'YES! Signs of working through: 1) Faster recognition ("Oh, I\'m doing that thing again"), 2) More emotional connection (not just intellectual), 3) Experimentation with alternatives (even if clumsy at first), 4) Greater self-compassion, 5) Less intense reaction over time. Progress is INCREMENTAL.' },
                                    { text: 'Client stops having any emotional reactions', correct: false, feedback: 'Emotional flatness might be dissociation or intellectualization, not integration. Healthy processing includes feeling, not numbing.' },
                                    { text: 'Therapist gets bored', correct: false, feedback: 'Your boredom is YOUR countertransference to manage! Doesn\'t indicate client\'s progress or lack thereof. Explore your reaction in supervision.' }
                                ]
                            },
                            {
                                question: 'Client keeps choosing emotionally unavailable partners despite understanding the pattern. How do you work with this?',
                                answers: [
                                    { text: '"Clearly you don\'t actually want to change."', correct: false, feedback: 'Judgmental and inaccurate. Change is complex. Understanding doesn\'t automatically = new behavior. This is why working through takes time.' },
                                    { text: 'Explore together: What does the familiar pattern offer (even if painful)? What\'s scary about choosing differently? Tolerate that insight precedes behavior change.', correct: true, feedback: 'EXCELLENT! Repetition compulsion is powerful - familiar pain feels safer than unknown. Explore: "What would it mean about you if you chose someone available?" Might uncover: "I don\'t deserve love," "I\'d be too vulnerable," "I wouldn\'t know how to be." Work with THESE fears. Behavior will change when safer.' },
                                    { text: 'Give them dating advice and rules', correct: false, feedback: 'This is behavioral intervention, not psychodynamic. Misses the UNCONSCIOUS PULL toward unavailable partners. Advice won\'t override unconscious attraction to familiar.' },
                                    { text: 'Tell them to stop dating for a year', correct: false, feedback: 'Directive and controlling. Client\'s autonomy matters. Focus on understanding WHY they choose this way, not controlling behavior.' }
                                ]
                            }
                        ]
                    }
                ]
            },

            // LEVEL 4: EXPERT
            {
                id: 'enactment',
                title: 'Enactments',
                icon: 'üé≠',
                level: 4,
                xp: 50,
                prereq: 'working-through',
                lessons: [
                    {
                        title: 'When Dynamics Get Lived Out',
                        teaching: `ENACTMENT: Client's internal conflict gets ENACTED (acted out) in therapeutic relationship, often pulling therapist into playing a role from client's past. Both participate unconsciously.

Different from transference alone - in enactment, therapist ACTS out complementary role instead of observing. Example: Client unconsciously provokes rejection ‚Üí therapist feels irritated and withdraws ‚Üí enactment of client's fear of rejection.

Enactments are: inevitable, informative, and opportunities for repair. They show you EXACTLY what client experiences relationally.`,
                        concepts: [
                            {
                                title: 'Recognizing Enactments',
                                text: 'Signs: You\'re acting out of character, feeling pulled to do something unusual, therapeutic frame is bent, you feel "off" but can\'t articulate why. Your countertransference feels COMPELLING rather than just present. Post-session guilt or confusion.'
                            },
                            {
                                title: 'Repairing Enactments',
                                text: 'Don\'t deny or hide it. NAME IT: "I noticed I got defensive just now. I\'m wondering if I fell into a familiar pattern - maybe how others respond when you express needs?" Use enactment as LIVE DEMONSTRATION of client\'s relational dynamic. Then REPAIR.'
                            }
                        ],
                        questions: [
                            {
                                question: 'Client keeps pushing boundaries (calling between sessions, asking personal questions). You find yourself getting increasingly rigid and cold. What\'s the enactment?',
                                answers: [
                                    { text: 'Client is manipulative and you\'re appropriately setting boundaries', correct: false, feedback: 'This misses the MUTUAL participation. Yes, set boundaries, but your COLDNESS suggests you\'re caught in enactment, not just being professional.' },
                                    { text: 'Client tests boundaries ‚Üí you become punitive ‚Üí recreates their experience of caregiver who withdrew when they had needs', correct: true, feedback: 'BRILLIANT! Client unconsciously recreates familiar dynamic: expressing need ‚Üí other person becomes rejecting. YOUR coldness (beyond appropriate boundaries) enacts the rejecting caregiver role. Recognize it, REPAIR: "I notice I\'ve been quite rigid. I wonder if my response feels familiar - like past people who pulled away when you needed something?"' },
                                    { text: 'Nothing wrong is happening', correct: false, feedback: 'Your strong countertransference (coldness) is DATA. Something relational is happening. Examine it.' },
                                    { text: 'Client needs DBT, not psychodynamic therapy', correct: false, feedback: 'This is exactly what psychodynamic therapy is FOR - examining relational enactments. Don\'t avoid the work.' }
                                ]
                            },
                            {
                                question: 'You realize you\'ve been late to sessions with a particular client multiple times. What might this enactment reveal?',
                                answers: [
                                    { text: 'You\'re just disorganized', correct: false, feedback: 'If it\'s PATTERN with one client, it\'s likely enactment, not general time management issue. Your unconscious is communicating something.' },
                                    { text: 'Client might evoke feeling unimportant, dismissed - possibly their core relational wound', correct: true, feedback: 'EXCELLENT self-awareness! Your lateness might ENACT how client feels/fears being treated: overlooked, low priority, not worth time. Explore in supervision: What about this client pulls this from you? Then address: "I\'ve been late several times. I\'m troubled by this and wondering if it connects to feelings of being overlooked you\'ve described elsewhere?"' },
                                    { text: 'Client is boring so you don\'t want to see them', correct: false, feedback: 'This is judgmental. Even if client feels "boring," ask: Why? What are THEY avoiding (through being "boring") and how are you enacting it (through lateness)?' },
                                    { text: 'Don\'t mention it, just start being on time', correct: false, feedback: 'Addressing enactment explicitly is THERAPEUTIC! Shows you can name difficult relational dynamics, take responsibility, and repair. This models healthy relationship.' }
                                ]
                            },
                            {
                                question: 'What\'s the most therapeutic way to address an enactment once recognized?',
                                answers: [
                                    { text: 'Ignore it and move on', correct: false, feedback: 'Enactments are rich clinical material! Naming and processing them is where deep work happens.' },
                                    { text: 'Blame the client for pulling you into it', correct: false, feedback: 'Enactment is MUTUAL. Both participate. Taking sole responsibility OR blaming client misses collaborative nature.' },
                                    { text: 'Name it, take responsibility for your part, explore its meaning together, and repair', correct: true, feedback: 'PERFECT! "I noticed I responded with coldness when you asked for extra time. I\'m wondering if I fell into a familiar role - maybe how others have been when you\'ve had needs? Let\'s talk about what that was like." This: acknowledges your role, links to their pattern, invites exploration, AND demonstrates repair is possible. Corrective experience!' },
                                    { text: 'Terminate therapy immediately', correct: false, feedback: 'Enactments aren\'t therapy failures! They\'re inevitable and informative. Rupture + repair is powerful. Only terminate if truly unworkable after attempts to repair.' }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                id: 'termination',
                title: 'Endings & Termination',
                icon: 'üëã',
                level: 4,
                xp: 45,
                prereq: 'enactment',
                lessons: [
                    {
                        title: 'The Final Separation',
                        teaching: `TERMINATION: Ending of therapy. Often overlooked but clinically crucial. How therapy ends affects whether gains are consolidated or lost.

Termination recapitulates ALL previous separations and losses in client's life. Client who had abrupt abandonment may flee therapy suddenly. Client who clung to parents may become dependent and unable to leave.

Good termination involves: adequate time (weeks to months), processing feelings about ending, reviewing progress, acknowledging what remains unfinished, mourning loss of relationship.`,
                        concepts: [
                            {
                                title: 'Types of Termination',
                                text: 'PLANNED (mutual agreement therapy is done). CLIENT-INITIATED (client decides to end, sometimes prematurely). THERAPIST-INITIATED (relocation, illness, unworkable dynamic). FORCED (insurance, graduation, life circumstance). Each requires different handling but all need processing.'
                            },
                            {
                                title: 'Termination Resistance',
                                text: 'Common patterns: 1) Sudden symptom return (anxiety about ending), 2) New crises (testing if you\'ll stay), 3) Devaluing therapy ("It didn\'t help anyway"), 4) Ghosting (avoiding goodbye pain). Name these as separation anxiety, not failure.'
                            }
                        ],
                        questions: [
                            {
                                question: 'Client has made significant progress and you both agree termination is approaching. Suddenly they report panic attacks returning. What\'s likely happening?',
                                answers: [
                                    { text: 'They weren\'t actually ready to terminate', correct: false, feedback: 'Maybe, but more likely this is TERMINATION ANXIETY, not indication they need more therapy. Explore the meaning.' },
                                    { text: 'Separation anxiety - ending therapy activates old fears of loss and abandonment', correct: true, feedback: 'YES! Termination often triggers symptom return. The ENDING itself is stressful, activating fears: "Can I manage without you?" "Will I fall apart alone?" Normalize this, process feelings about ending, reassure progress is real even with temporary setback.' },
                                    { text: 'Your therapy failed', correct: false, feedback: 'No! Termination is HARD. Symptoms near end are common and meaningful. Process this as part of termination work.' },
                                    { text: 'They need medication', correct: false, feedback: 'Possibly, but first explore relational meaning of symptom return at THIS time. Likely connected to ending.' }
                                ]
                            },
                            {
                                question: 'Client texts that they won\'t be coming back to therapy, thanks for everything. No prior discussion of ending. What do you do?',
                                answers: [
                                    { text: 'Accept it and move on', correct: false, feedback: 'Premature termination without processing is missed opportunity. Client likely avoiding pain of goodbye (common pattern in their life?). Reach out.' },
                                    { text: 'Call or text back: "I\'d like to meet one more time to properly end our work together. Even one session can be helpful."', correct: true, feedback: 'EXCELLENT! Offer TERMINATION SESSION even if they want to end. One goodbye session can: process feelings, review progress, identify triggers for sudden ending, provide closure. Many clients agree when offered. If they refuse, respect it, but you tried.' },
                                    { text: 'Feel rejected and do nothing', correct: false, feedback: 'Your hurt feelings are valid countertransference but don\'t let them prevent you from offering what\'s therapeutic. Client needs termination work even if they don\'t know it.' },
                                    { text: 'Get angry at them for ghosting', correct: false, feedback: 'Your anger is understandable but not helpful. Client is likely ENACTING their attachment pattern (flee vs process endings). This IS the work. Stay professional.' }
                                ]
                            },
                            {
                                question: 'What makes a "good enough" termination?',
                                answers: [
                                    { text: 'Client is completely symptom-free', correct: false, feedback: 'Unrealistic! Therapy goals are broader: better coping, self-understanding, relational capacity. "Cured" isn\'t the standard.' },
                                    { text: 'Adequate time to process ending, review therapy, acknowledge gains and limitations, express feelings including loss', correct: true, feedback: 'PERFECT! Good termination: 1) Time (multiple sessions dedicated to ending), 2) Review (what helped, what changed, what stays hard), 3) Express feelings (sadness, gratitude, ambivalence all okay), 4) Realistic expectations (not perfect, but better), 5) Open door (can return if needed). This consolidates gains.' },
                                    { text: 'Client never has problems again', correct: false, feedback: 'Impossibly idealistic! Life continues to bring challenges. Success = better equipped to handle them, not immune to them.' },
                                    { text: 'Client and therapist become friends after', correct: false, feedback: 'Boundary violation! Post-termination friendship is generally inappropriate. The therapeutic relationship remains special and separate.' }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                id: 'advanced-technique',
                title: 'Advanced Clinical Mastery',
                icon: 'üéì',
                level: 4,
                xp: 60,
                prereq: 'termination',
                lessons: [
                    {
                        title: 'Integration & Artistry',
                        teaching: `MASTERY in psychodynamic therapy means: holding theoretical knowledge lightly, attending to unconscious communication, tracking multiple levels simultaneously (content, affect, defense, transference, countertransference), intervening with precision and timing.

You've learned the techniques. Now comes INTEGRATION - weaving them together fluidly, trusting your clinical intuition, staying present to the mystery and complexity of each unique person.

Advanced work involves: navigating impasses, working with primitive defenses, managing severe pathology, integrating other modalities when needed, maintaining your own depth and growth.`,
                        concepts: [
                            {
                                title: 'The Use of Self',
                                text: 'At expert level, YOU are the instrument. Your presence, authenticity, capacity to stay regulated in chaos, willingness to be affected while maintaining boundaries - these matter as much as technique. Know yourself deeply. Stay in your own therapy/analysis.'
                            },
                            {
                                title: 'Lifelong Learning',
                                text: 'Psychodynamic mastery is never "complete." Field evolves (neuropsychoanalysis, relational psychoanalysis, contemporary approaches). Your understanding deepens. Stay humble, curious, supervised. Read widely. Each client teaches you something.'
                            }
                        ],
                        questions: [
                            {
                                question: 'What distinguishes expert psychodynamic therapist from competent one?',
                                answers: [
                                    { text: 'Knowing more theory', correct: false, feedback: 'Theory matters but isn\'t enough. Competent therapist knows theory. Expert EMBODIES it - uses flexibly, integrates multiple frameworks, holds lightly.' },
                                    { text: 'Comfort with uncertainty, complexity, and not-knowing; ability to stay present to unconscious process while tracking multiple levels', correct: true, feedback: 'YES! Expert holds paradoxes: knowing AND not-knowing. Tracks what\'s said AND what\'s not said. Notices own reactions while attending to client. Tolerates ambiguity, trusts process. This comes from: extensive training, personal therapy, supervision, experience, ongoing learning.' },
                                    { text: 'Never making mistakes', correct: false, feedback: 'Experts make mistakes! Difference: they recognize faster, repair more skillfully, learn from errors. Perfection isn\'t the goal.' },
                                    { text: 'Having all the answers', correct: false, feedback: 'Opposite! Experts are comfortable saying "I don\'t know." They trust the PROCESS to reveal what\'s needed, rather than forcing understanding prematurely.' }
                                ]
                            },
                            {
                                question: 'You\'ve been seeing a client for 2 years. Work feels stuck, repetitive, lifeless. What do you do?',
                                answers: [
                                    { text: 'Keep doing the same thing - eventually it will shift', correct: false, feedback: 'Wishful thinking! Stuckness requires examination, not passive hoping.' },
                                    { text: 'Terminate - you\'re clearly not helping', correct: false, feedback: 'Premature! Impasses are RICH clinical material. Don\'t flee. Explore first. Termination is option if truly unworkable after examination.' },
                                    { text: 'Bring to supervision: examine the stuckness as enactment, explore your countertransference, consider if something is being AVOIDED', correct: true, feedback: 'EXACTLY! Impasses often mean: unconscious collusion (both avoiding something), parallel deadness (mirroring client\'s internal state), therapist\'s own stuckness. Supervision helps see what you can\'t see alone. Ask: What would be threatening to address? What am I avoiding? What does the stuckness represent for client?' },
                                    { text: 'Switch to CBT', correct: false, feedback: 'Switching modalities might help sometimes, but first UNDERSTAND the stuckness psychodynamically. It has meaning. Don\'t abandon frame without exploring.' }
                                ]
                            },
                            {
                                question: 'After years of practice, what continues to be most important?',
                                answers: [
                                    { text: 'Memorizing diagnostic criteria', correct: false, feedback: 'Diagnosis has place, but psychodynamic work is deeper than DSM categories. Understanding PERSON matters more than label.' },
                                    { text: 'Your own ongoing therapy, supervision, and personal development', correct: true, feedback: 'CRUCIAL! You can\'t take clients deeper than you\'ve gone yourself. Your unexamined wounds limit your work. Your ongoing growth expands your capacity. Personal therapy never ends. Supervision continues even for seasoned therapists. Humility and self-reflection are lifelong practices. The work is as much about WHO YOU ARE as what you know.' },
                                    { text: 'Reading the latest therapy fads', correct: false, feedback: 'Stay current, yes. But depth matters more than novelty. Psychodynamic principles (unconscious, transference, defense) remain relevant across fads.' },
                                    { text: 'Retiring and doing something else', correct: false, feedback: 'Many therapists practice into old age because the work remains meaningful, challenging, alive. If burned out, address that. But age can bring wisdom to the work.' }
                                ]
                            }
                        ]
                    }
                ]
            }
        ];

        function initSkillTree() {
            const container = document.getElementById('skill-tree');
            container.innerHTML = '';
            
            skillTree.forEach(skill => {
                const isCompleted = gameState.completedSkills.includes(skill.id);
                const isUnlocked = !skill.prereq || gameState.completedSkills.includes(skill.prereq);
                const progress = gameState.skillProgress[skill.id] || 0;
                const totalLessons = skill.lessons.length;
                
                const node = document.createElement('div');
                node.className = `skill-node ${isCompleted ? 'completed' : ''} ${isUnlocked ? 'unlocked' : 'locked'}`;
                
                // Find prerequisite skill name
                let prereqName = '';
                if (!isUnlocked && skill.prereq) {
                    const prereqSkill = skillTree.find(s => s.id === skill.prereq);
                    prereqName = prereqSkill ? prereqSkill.title : '';
                }
                
                node.innerHTML = `
                    ${!isUnlocked ? '<div class="skill-lock">üîí</div>' : ''}
                    <div class="skill-icon">${skill.icon}</div>
                    <div class="skill-title">${skill.title}</div>
                    ${isCompleted ? '<div style="margin-top:8px; color:#ff0;">‚úì MASTERED</div>' : ''}
                    ${!isUnlocked && prereqName ? `<div class="skill-prereq">Complete: ${prereqName}</div>` : ''}
                `;
                
                // Make unlocked nodes keyboard accessible
                if (isUnlocked && !isCompleted) {
                    node.setAttribute('tabindex', '0');
                    node.setAttribute('role', 'button');
                    node.setAttribute('aria-label', `Start ${skill.title} skill`);
                    node.onclick = () => startSkill(skill);
                    node.onkeypress = (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            startSkill(skill);
                        }
                    };
                }
                
                container.appendChild(node);
            });
            
            updateHeader();
            updatePathDisplay();
        }
        
        function updatePathDisplay() {
            const level = gameState.level;
            let path = 'FOUNDATIONS';
            if (level >= 4) path = 'EXPERT';
            else if (level >= 3) path = 'ADVANCED';
            else if (level >= 2) path = 'INTERMEDIATE';
            
            document.getElementById('current-path').textContent = path;
        }
        
        function updateHeader() {
            const xpPercent = (gameState.xp / gameState.xpToNextLevel) * 100;
            document.getElementById('xp-bar').style.width = xpPercent + '%';
            document.getElementById('xp-text').textContent = `${gameState.xp} / ${gameState.xpToNextLevel} XP`;
            document.getElementById('level-display').textContent = gameState.level;
            
            const totalSkills = skillTree.length;
            const completedCount = gameState.completedSkills.length;
            const masteryPercent = Math.round((completedCount / totalSkills) * 100);
            document.getElementById('mastery-display').textContent = masteryPercent + '%';
            document.getElementById('streak-display').textContent = gameState.streak + 'üî•';
        }
        
        function startSkill(skill) {
            gameState.currentLesson = skill;
            gameState.currentQuestion = 0;
            gameState.correctAnswers = 0;
            showLesson(skill.lessons[0]);
        }
        
        function showLesson(lesson) {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modal-content');
            
            const concepts = lesson.concepts.map(c => `
                <div class="key-concept">
                    <div class="concept-title">${c.title}</div>
                    <div class="concept-text">${c.text}</div>
                </div>
            `).join('');
            
            content.innerHTML = `
                <div class="lesson-header">
                    <div class="lesson-title">${lesson.title}</div>
                    <div class="lesson-subtitle">${gameState.currentLesson.title}</div>
                </div>
                
                <div class="teaching-section">
                    <div class="teaching-text">${lesson.teaching}</div>
                    ${concepts}
                </div>
                
                <button class="continue-btn" onclick="startQuestions()">START QUESTIONS ‚Üí</button>
                <button class="back-btn" onclick="closeModal()">‚úï BACK</button>
                <div style="clear:both;"></div>
            `;
            
            modal.classList.add('active');
        }
        
        function startQuestions() {
            const lesson = gameState.currentLesson.lessons[0];
            showQuestion(lesson.questions[gameState.currentQuestion]);
        }
        
        function showQuestion(question) {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modal-content');
            
            // Store question in global for answer checking
            window.currentQuestion = question;
            
            const answerButtons = question.answers.map((ans, idx) => `
                <button class="answer-btn" onclick="checkAnswer(${idx})">${ans.text}</button>
            `).join('');
            
            const progress = `Question ${gameState.currentQuestion + 1} of ${gameState.currentLesson.lessons[0].questions.length}`;
            const totalQuestions = gameState.currentLesson.lessons[0].questions.length;
            const scoreDisplay = gameState.currentQuestion > 0 
                ? `<div class="score-tracker">SCORE: <span class="score-value">${gameState.correctAnswers}/${gameState.currentQuestion}</span> correct so far</div>`
                : '';
            
            content.innerHTML = `
                <div class="lesson-header">
                    <div class="lesson-title">${gameState.currentLesson.title}</div>
                    <div class="lesson-subtitle">${progress}</div>
                </div>
                
                ${scoreDisplay}
                
                <div class="question-section">
                    <div class="question-text">${question.question}</div>
                    <div class="answers" id="answers">
                        ${answerButtons}
                    </div>
                    <div class="feedback" id="feedback"></div>
                </div>
                
                <div id="continue-container"></div>
                <button class="back-btn" onclick="closeModal()">‚úï BACK</button>
                <div style="clear:both;"></div>
            `;
            
            modal.classList.add('active');
        }
        
        function checkAnswer(idx) {
            const question = window.currentQuestion;
            const answer = question.answers[idx];
            
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach(btn => btn.classList.add('disabled'));
            
            const clickedBtn = buttons[idx];
            const feedback = document.getElementById('feedback');
            
            if (answer.correct) {
                clickedBtn.classList.add('correct');
                feedback.className = 'feedback correct';
                feedback.textContent = '‚úì CORRECT! ' + answer.feedback;
                gameState.correctAnswers++;
            } else {
                clickedBtn.classList.add('incorrect');
                feedback.className = 'feedback incorrect';
                feedback.textContent = '‚úó ' + answer.feedback;
            }
            
            const continueContainer = document.getElementById('continue-container');
            continueContainer.innerHTML = '<button class="continue-btn" onclick="nextQuestion()">CONTINUE ‚Üí</button>';
        }
        
        function nextQuestion() {
            gameState.currentQuestion++;
            const lesson = gameState.currentLesson.lessons[0];
            
            if (gameState.currentQuestion < lesson.questions.length) {
                showQuestion(lesson.questions[gameState.currentQuestion]);
            } else {
                completeSkill();
            }
        }
        
        function completeSkill() {
            const skill = gameState.currentLesson;
            const xpEarned = skill.xp;
            const questionsTotal = skill.lessons[0].questions.length;
            const score = Math.round((gameState.correctAnswers / questionsTotal) * 100);
            
            // Award XP
            gameState.xp += xpEarned;
            gameState.totalXp += xpEarned;
            
            // Check level up
            while (gameState.xp >= gameState.xpToNextLevel) {
                gameState.xp -= gameState.xpToNextLevel;
                gameState.level++;
                gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5);
            }
            
            // Update progress
            if (!gameState.skillProgress[skill.id]) {
                gameState.skillProgress[skill.id] = 0;
            }
            gameState.skillProgress[skill.id]++;
            
            // Mark completed
            if (!gameState.completedSkills.includes(skill.id)) {
                gameState.completedSkills.push(skill.id);
                gameState.streak++;
            }
            
            const modal = document.getElementById('modal');
            const content = document.getElementById('modal-content');
            
            // Find next available skill
            const currentIndex = skillTree.findIndex(s => s.id === skill.id);
            const nextSkill = skillTree.slice(currentIndex + 1).find(s => {
                if (!s.prereq) return true;
                return gameState.completedSkills.includes(s.prereq);
            });
            
            const nextSkillButton = nextSkill && !gameState.completedSkills.includes(nextSkill.id)
                ? `<button class="next-skill-btn" onclick="startNextSkill('${nextSkill.id}')">‚Üí NEXT: ${nextSkill.title}</button>`
                : '';
            
            content.innerHTML = `
                <div class="completion-screen">
                    <div class="completion-icon">${skill.icon}</div>
                    <div class="completion-title">SKILL MASTERED!</div>
                    <div class="xp-earned">+${xpEarned} XP EARNED</div>
                    <div class="teaching-text">
                        Score: ${score}% (${gameState.correctAnswers}/${questionsTotal} correct)<br><br>
                        You've completed "${skill.title}"<br><br>
                        Keep building your psychodynamic mastery!
                    </div>
                    ${nextSkillButton}
                    <button class="continue-btn" onclick="closeModalAndRefresh()">BACK TO SKILL TREE ‚Üí</button>
                </div>
            `;
            
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
            
            saveProgress();
        }
        
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }
        
        function closeModalAndRefresh() {
            closeModal();
            initSkillTree();
        }
        
        function saveProgress() {
            localStorage.setItem('psychodynamicAcademy', JSON.stringify(gameState));
        }
        
        function loadProgress() {
            const saved = localStorage.getItem('psychodynamicAcademy');
            if (saved) {
                gameState = JSON.parse(saved);
                initSkillTree();
                alert('‚úì Progress loaded!');
            } else {
                alert('No saved progress found.');
            }
        }
        
        function resetProgress() {
            if (confirm('Reset all progress? This cannot be undone.')) {
                localStorage.removeItem('psychodynamicAcademy');
                location.reload();
            }
        }
        
        function startNextSkill(skillId) {
            const skill = skillTree.find(s => s.id === skillId);
            if (skill) {
                closeModal();
                setTimeout(() => startSkill(skill), 300);
            }
        }
        
        // Initialize
        initSkillTree();
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('modal');
            const isModalOpen = modal.classList.contains('active');
            
            // ESC to close modal
            if (e.key === 'Escape' && isModalOpen) {
                closeModal();
            }
            
            // H to go home (when modal is closed)
            if (e.key === 'h' && !isModalOpen) {
                window.location.href = 'learning-library-hub.html';
            }
            
            // S to save progress (when modal is closed)
            if (e.key === 's' && !isModalOpen) {
                e.preventDefault();
                saveProgress();
                alert('üíæ Progress saved!');
            }
        });
        
        // Make answer buttons keyboard accessible
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('answer-btn')) {
                // Add focus to clicked answer
                e.target.focus();
            }
        });
        
        console.log('%c‚ö° PSYCHODYNAMIC ACADEMY LOADED', 'color: #0f0; font-size: 16px; font-weight: bold;');
        console.log('%c‚å®Ô∏è  Keyboard Shortcuts:', 'color: #0ff; font-size: 12px;');
        console.log('  ‚Ä¢ ESC - Close modal');
        console.log('  ‚Ä¢ H - Return to home');
        console.log('  ‚Ä¢ S - Save progress');
        console.log('  ‚Ä¢ TAB - Navigate skills');
        console.log('  ‚Ä¢ ENTER - Start selected skill');
    </script>
</body>
</html>
