<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a0a00">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>THE DRAMA OF THE GIFTED CHILD</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        :root { --primary: #fa0; --secondary: #fc0; --success: #0f0; --danger: #f44; --bg-dark: #000; --bg-card: #0d0700; --bg-elevated: #1a0a00; --border-subtle: #331a00; --text-muted: #666; --space-xs: 4px; --space-sm: 8px; --space-md: 12px; --space-lg: 16px; --space-xl: 24px; --touch-target: 44px; --border-width: 3px; --radius-sm: 4px; --radius-md: 8px; --safe-top: env(safe-area-inset-top, 0px); --safe-bottom: env(safe-area-inset-bottom, 0px); --safe-left: env(safe-area-inset-left, 0px); --safe-right: env(safe-area-inset-right, 0px); }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html { font-size: 16px; scroll-behavior: smooth; }
        body { font-family: 'Press Start 2P', cursive; background: var(--bg-dark); color: var(--primary); min-height: 100vh; min-height: 100dvh; overflow-x: hidden; padding-bottom: calc(70px + var(--safe-bottom)); }
        body::after { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: repeating-linear-gradient(0deg, rgba(0,0,0,0.08), rgba(0,0,0,0.08) 1px, transparent 1px, transparent 2px); pointer-events: none; z-index: 9999; }
        .header { position: sticky; top: 0; z-index: 100; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); padding: var(--space-md); padding-top: calc(var(--space-md) + var(--safe-top)); border-bottom: var(--border-width) solid var(--primary); }
        .header-content { max-width: 600px; margin: 0 auto; }
        .title { font-size: 9px; color: var(--primary); text-shadow: 2px 2px var(--secondary), 0 0 20px rgba(255,170,0,0.5); text-align: center; margin-bottom: var(--space-xs); }
        .subtitle { font-size: 6px; color: var(--secondary); text-align: center; margin-bottom: var(--space-md); opacity: 0.8; }
        .xp-bar-outer { background: var(--border-subtle); border: 2px solid var(--primary); border-radius: var(--radius-sm); height: 18px; position: relative; overflow: hidden; margin-bottom: var(--space-sm); }
        .xp-bar-fill { background: linear-gradient(90deg, var(--primary), var(--secondary)); height: 100%; width: 0%; transition: width 0.5s; position: relative; }
        .xp-bar-fill::after { content: ''; position: absolute; inset: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); animation: shimmer 2s infinite; }
        @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        .xp-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); font-size: 7px; color: #fff; text-shadow: 1px 1px 2px #000; }
        .stats-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: var(--space-xs); text-align: center; }
        .stat-box { background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); padding: var(--space-xs) var(--space-sm); }
        .stat-label { font-size: 5px; color: var(--text-muted); margin-bottom: 2px; }
        .stat-value { font-size: 9px; color: var(--secondary); }
        .main-content { padding: var(--space-md); padding-left: calc(var(--space-md) + var(--safe-left)); padding-right: calc(var(--space-md) + var(--safe-right)); max-width: 600px; margin: 0 auto; }
        .path-indicator { text-align: center; font-size: 7px; color: var(--text-muted); margin-bottom: var(--space-md); padding: var(--space-sm); border: 1px dashed var(--border-subtle); border-radius: var(--radius-sm); }
        .path-name { color: var(--secondary); font-size: 8px; }
        .skill-grid { display: flex; flex-direction: column; gap: var(--space-md); }
        .skill-card { background: var(--bg-card); border: var(--border-width) solid var(--border-subtle); border-radius: var(--radius-md); padding: var(--space-lg); display: flex; align-items: center; gap: var(--space-md); cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden; min-height: var(--touch-target); }
        .skill-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--border-subtle); }
        .skill-card.unlocked { border-color: var(--primary); }
        .skill-card.unlocked::before { background: var(--primary); }
        .skill-card.unlocked:active { transform: scale(0.98); background: var(--bg-elevated); }
        .skill-card.completed { border-color: var(--secondary); background: rgba(255,204,0,0.03); }
        .skill-card.completed::before { background: var(--secondary); }
        .skill-card.locked { opacity: 0.4; cursor: not-allowed; }
        .skill-icon { font-size: 28px; width: 40px; text-align: center; }
        .skill-info { flex: 1; min-width: 0; }
        .skill-title { font-size: 8px; color: var(--primary); margin-bottom: var(--space-xs); line-height: 1.4; }
        .skill-card.completed .skill-title { color: var(--secondary); }
        .skill-meta { display: flex; gap: var(--space-sm); font-size: 6px; color: var(--text-muted); }
        .skill-xp { color: var(--secondary); }
        .skill-status { margin-left: auto; font-size: 16px; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.98); backdrop-filter: blur(10px); border-top: var(--border-width) solid var(--primary); padding: var(--space-sm); padding-bottom: calc(var(--space-sm) + var(--safe-bottom)); z-index: 100; }
        .nav-buttons { display: flex; justify-content: space-around; max-width: 400px; margin: 0 auto; }
        .nav-btn { background: transparent; border: none; color: var(--primary); font-family: inherit; font-size: 6px; padding: var(--space-sm); min-width: 60px; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; border-radius: var(--radius-sm); }
        .nav-btn:active { background: rgba(255,170,0,0.1); transform: scale(0.95); }
        .nav-btn .icon { font-size: 20px; }
        .nav-btn.home-btn { color: var(--secondary); }
        .modal-overlay { display: none; position: fixed; inset: 0; background: var(--bg-dark); z-index: 1000; overflow-y: scroll; -webkit-overflow-scrolling: touch; }
        .modal-overlay.active { display: block; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { min-height: 100%; padding: var(--space-lg); padding-top: calc(var(--space-lg) + var(--safe-top)); padding-bottom: calc(100px + var(--safe-bottom)); max-width: 600px; margin: 0 auto; }
        .lesson-header { text-align: center; margin-bottom: var(--space-xl); padding-bottom: var(--space-lg); border-bottom: 2px solid var(--border-subtle); }
        .lesson-icon { font-size: 40px; margin-bottom: var(--space-sm); }
        .lesson-title { font-size: 10px; color: var(--primary); margin-bottom: var(--space-xs); line-height: 1.5; }
        .lesson-subtitle { font-size: 7px; color: var(--secondary); }
        .teaching-section { background: var(--bg-elevated); border: 2px solid var(--primary); border-radius: var(--radius-md); padding: var(--space-lg); margin-bottom: var(--space-xl); }
        .teaching-text { font-size: 9px; line-height: 2; color: var(--primary); white-space: pre-wrap; }
        .concept-card { background: var(--bg-dark); border-left: 4px solid var(--secondary); padding: var(--space-md); margin-bottom: var(--space-md); border-radius: 0 var(--radius-sm) var(--radius-sm) 0; }
        .concept-title { font-size: 8px; color: var(--secondary); margin-bottom: var(--space-sm); }
        .concept-text { font-size: 8px; line-height: 1.8; color: var(--primary); opacity: 0.9; }
        .question-progress { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 1px solid var(--border-subtle); }
        .progress-dots { display: flex; gap: var(--space-xs); }
        .progress-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--border-subtle); border: 1px solid var(--text-muted); }
        .progress-dot.current { background: var(--primary); border-color: var(--primary); box-shadow: 0 0 8px var(--primary); }
        .progress-dot.correct { background: var(--success); border-color: var(--success); }
        .progress-dot.incorrect { background: var(--danger); border-color: var(--danger); }
        .score-display { font-size: 7px; color: var(--primary); }
        .score-value { color: var(--secondary); }
        .question-text { font-size: 10px; line-height: 1.8; color: var(--secondary); margin-bottom: var(--space-xl); padding: var(--space-lg); background: var(--bg-elevated); border-radius: var(--radius-md); border: 2px solid var(--secondary); }
        .answers-list { display: flex; flex-direction: column; gap: var(--space-md); }
        .answer-btn { background: var(--bg-card); border: var(--border-width) solid var(--primary); color: var(--primary); font-family: inherit; font-size: 8px; line-height: 1.7; padding: var(--space-lg); text-align: left; cursor: pointer; border-radius: var(--radius-md); transition: all 0.15s; }
        .answer-btn:active:not(.disabled) { transform: scale(0.98); background: var(--bg-elevated); }
        .answer-btn.correct { border-color: var(--success); background: rgba(0,255,0,0.1); }
        .answer-btn.incorrect { border-color: var(--danger); background: rgba(255,68,68,0.1); }
        .answer-btn.disabled { opacity: 0.5; cursor: not-allowed; }
        .feedback-box { margin-top: var(--space-lg); padding: var(--space-lg); border-radius: var(--radius-md); font-size: 8px; line-height: 1.8; display: none; }
        .feedback-box.show { display: block; }
        .feedback-box.correct { background: rgba(0,255,0,0.1); border: 2px solid var(--success); color: var(--success); }
        .feedback-box.incorrect { background: rgba(255,68,68,0.1); border: 2px solid var(--danger); color: var(--danger); }
        .modal-footer { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.98); backdrop-filter: blur(10px); padding: var(--space-md); padding-bottom: calc(var(--space-md) + var(--safe-bottom)); display: flex; gap: var(--space-md); z-index: 1001; }
        .btn { flex: 1; font-family: inherit; font-size: 8px; padding: var(--space-md) var(--space-lg); border-radius: var(--radius-sm); cursor: pointer; min-height: var(--touch-target); display: flex; align-items: center; justify-content: center; }
        .btn:active { transform: scale(0.97); }
        .btn-primary { background: rgba(255,170,0,0.1); border: var(--border-width) solid var(--primary); color: var(--primary); }
        .btn-secondary { background: transparent; border: 2px solid var(--text-muted); color: var(--text-muted); }
        .btn-accent { background: rgba(255,204,0,0.1); border: var(--border-width) solid var(--secondary); color: var(--secondary); }
        .completion-screen { text-align: center; padding: var(--space-xl) 0; }
        .completion-icon { font-size: 64px; margin-bottom: var(--space-lg); animation: bounce 1s infinite; }
        @keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .completion-title { font-size: 14px; color: var(--primary); margin-bottom: var(--space-md); }
        .completion-xp { font-size: 12px; color: var(--secondary); margin-bottom: var(--space-xl); }
        .completion-stats { background: var(--bg-elevated); border: 2px solid var(--primary); border-radius: var(--radius-md); padding: var(--space-xl); margin-bottom: var(--space-xl); }
        .completion-stats p { font-size: 9px; line-height: 2; margin-bottom: var(--space-sm); }
        .toast { position: fixed; bottom: calc(80px + var(--safe-bottom)); left: 50%; transform: translateX(-50%) translateY(100px); background: var(--bg-elevated); border: 2px solid var(--primary); padding: var(--space-md) var(--space-xl); border-radius: var(--radius-md); font-size: 8px; color: var(--primary); z-index: 2000; opacity: 0; transition: all 0.3s; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        @media (min-width: 768px) { .skill-grid { display: grid; grid-template-columns: repeat(2,1fr); } .skill-card:hover:not(.locked) { transform: translateY(-2px); box-shadow: 0 0 20px rgba(255,170,0,0.2); } }
    </style>
</head>
<body>
    <header class="header"><div class="header-content">
        <h1 class="title">üé≠ THE DRAMA OF THE GIFTED CHILD üé≠</h1>
        <p class="subtitle">ALICE MILLER ON THE FALSE SELF</p>
        <div class="xp-bar-outer"><div class="xp-bar-fill" id="xp-bar"></div><div class="xp-text" id="xp-text">0 / 100 XP</div></div>
        <div class="stats-grid">
            <div class="stat-box"><div class="stat-label">LEVEL</div><div class="stat-value" id="level-display">1</div></div>
            <div class="stat-box"><div class="stat-label">MASTERY</div><div class="stat-value" id="mastery-display">0%</div></div>
            <div class="stat-box"><div class="stat-label">STREAK</div><div class="stat-value" id="streak-display">0üî•</div></div>
        </div>
    </div></header>
    <main class="main-content">
        <div class="path-indicator">CURRENT PATH: <span class="path-name" id="current-path">FOUNDATIONS</span></div>
        <div class="skill-grid" id="skill-grid"></div>
    </main>
    <nav class="bottom-nav"><div class="nav-buttons">
        <button class="nav-btn home-btn" onclick="goHome()"><span class="icon">üè†</span><span>HOME</span></button>
        <button class="nav-btn" onclick="saveProgress()"><span class="icon">üíæ</span><span>SAVE</span></button>
        <button class="nav-btn" onclick="loadProgress()"><span class="icon">üìÅ</span><span>LOAD</span></button>
        <button class="nav-btn" onclick="resetProgress()"><span class="icon">üîÑ</span><span>RESET</span></button>
    </div></nav>
    <div class="modal-overlay" id="modal"><div class="modal-content" id="modal-content"></div></div>
    <div class="toast" id="toast"></div>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        let gameState = { level: 1, xp: 0, xpToNextLevel: 100, totalXp: 0, streak: 0, completedSkills: [], skillProgress: {}, currentLesson: null, currentQuestion: 0, correctAnswers: 0, questionResults: [] };
        const skillTree = [
            { id: 'false-self', title: 'The False Self', icon: 'üé≠', level: 1, xp: 20, prereq: null, lessons: [{ title: 'Adaptation to Narcissistic Parents', teaching: `Alice Miller's core insight: The "GIFTED CHILD" develops FALSE SELF to meet parents' narcissistic needs.

"Gifted" means PERCEPTIVE, SENSITIVE child who adapts to parents' emotional needs. Expert at: reading moods, suppressing own needs, becoming what parents need.

The price: disconnection from authentic feelings. "My real self is unacceptable."`, concepts: [{ title: 'Narcissistic Use', text: 'Parent uses child to regulate OWN states. Child exists to serve parent\'s needs, not as separate person.' }, { title: 'The Adaptation', text: 'Child develops: hypervigilance, caregiving, perfectionism, suppression. All for love by being what parent needs.' }], questions: [{ question: 'What does Miller mean by "gifted child"?', answers: [{ text: 'High IQ children', correct: false, feedback: '"Gifted" means emotionally perceptive.' }, { text: 'Sensitive child who adapts by developing false self', correct: true, feedback: 'EXACTLY! "Gifted" in reading cues, becoming what parents require.' }, { text: 'Children who receive gifts', correct: false, feedback: 'Not literal gifts!' }, { text: 'Lucky children', correct: false, feedback: 'Opposite! These have narcissistic parents.' }] }, { question: 'Client says mother was "always proud of achievements." Miller suspects?', answers: [{ text: 'Healthy parenting', correct: false, feedback: 'Was mother proud of CHILD or herself through child?' }, { text: 'Narcissistic use - mother basking for her own self-esteem', correct: true, feedback: 'Was worth contingent on achievements?' }, { text: 'All parents are proud', correct: false, feedback: 'Healthy parent celebrates child\'s joy vs needing success for OWN esteem.' }, { text: 'Client is ungrateful', correct: false, feedback: 'If not truly SEEN, gratitude doesn\'t heal.' }] }, { question: 'What is the "false self"?', answers: [{ text: 'Lying', correct: false, feedback: 'Not conscious! Develops unconsciously.' }, { text: 'Persona to meet others\' needs while losing authentic self', correct: true, feedback: 'Feels hollow, driven by "shoulds."' }, { text: 'Low self-esteem', correct: false, feedback: 'Can appear HIGHLY successful!' }, { text: 'Pretending happy', correct: false, feedback: 'Entire personality structure.' }] }] }] },
            { id: 'repressed-feelings', title: 'Repressed Feelings', icon: 'üîí', level: 1, xp: 25, prereq: 'false-self', lessons: [{ title: 'The Price of Adaptation', teaching: `To maintain false self, child REPRESSES feelings - rage, grief, neediness.

Rage at being used ‚Üí but anger risks losing parent. Grief at loss ‚Üí but mourning acknowledges loss.

Repression isn't conscious. Adult doesn't know what they're feeling.`, concepts: [{ title: 'Forbidden Feelings', text: 'Most forbidden: RAGE at parents. So rage turns to: depression, self-attack, numbness.' }, { title: 'Symptoms as Expression', text: 'Repressed feelings emerge as: depression, anxiety, somatic symptoms. Symptoms are LANGUAGE of repressed self.' }], questions: [{ question: 'Client describes perfect childhood but has chronic depression. Miller explores:', answers: [{ text: 'They\'re lying', correct: false, feedback: 'May not recognize harm.' }, { text: 'What was forbidden - feelings that couldn\'t be expressed', correct: true, feedback: '"Perfect" = adapted, true self buried. Depression = protest.' }, { text: 'Depression is biological', correct: false, feedback: 'Miller sees depression as meaningful.' }, { text: 'Focus on present', correct: false, feedback: 'Accessing childhood essential.' }] }, { question: '"Depression is healthy response to unhealthy situation" means?', answers: [{ text: 'Depression is good', correct: false, feedback: 'Not desirable! But meaningful.' }, { text: 'Psyche\'s protest against false life', correct: true, feedback: 'Refuses to collude with self-betrayal.' }, { text: 'Only in bad situations', correct: false, feedback: 'Focuses on false self depression.' }, { text: 'Healthy never depressed', correct: false, feedback: 'Living falsely creates depression.' }] }] }] },
            { id: 'poisonous-pedagogy', title: 'Poisonous Pedagogy', icon: '‚ö†Ô∏è', level: 2, xp: 30, prereq: 'repressed-feelings', lessons: [{ title: 'Traditional Child-Rearing as Abuse', teaching: `"POISONOUS PEDAGOGY": practices that break will, demand obedience, suppress feelings, use shame.

Examples: "Children seen not heard," "Spare the rod," "Don't cry or I'll give you something to cry about."

Appear normal but: deny reality, suppress authentic self. ABUSE disguised as parenting.`, concepts: [{ title: 'How It Works', text: 'Tells child: feelings wrong, will must be broken. Child learns: I am flawed.' }, { title: 'Intergenerational', text: 'Parents use it because used on them. Breaking child prevents their feelings emerging.' }], questions: [{ question: 'Client: "I was spanked and turned out fine."', answers: [{ text: 'They did turn out fine', correct: false, feedback: 'Connected to true self? Or adapted?' }, { text: '"Fine" may mean successful adaptation - defending parents prevents feeling pain', correct: true, feedback: '"I\'m fine" protects from rage and grief.' }, { text: 'All discipline poisonous', correct: false, feedback: 'Distinguishes respect vs. breaking will.' }, { text: 'They\'re lying', correct: false, feedback: 'Genuinely believe because recognizing damage threatening.' }] }, { question: 'Set limits without poisonous pedagogy?', answers: [{ text: 'Never set limits', correct: false, feedback: 'Not against boundaries!' }, { text: 'Set limits respecting feelings - explain, no shame', correct: true, feedback: 'Validate feeling, set boundary.' }, { text: 'Children don\'t need limits', correct: false, feedback: 'Need limits. Issue is method.' }, { text: 'Do whatever child wants', correct: false, feedback: 'Respect FEELINGS while maintaining boundaries.' }] }] }] },
            { id: 'compulsion-repeat', title: 'Compulsion to Repeat', icon: 'üîÑ', level: 2, xp: 30, prereq: 'poisonous-pedagogy', lessons: [{ title: 'Why We Recreate Pain', teaching: `People RECREATE childhood dynamics because:
1. Familiar = safe
2. Hope for different outcome
3. Attempt to master trauma

Example: choosing partners like abusive parent.

Stops only when original pain consciously felt.`, concepts: [{ title: 'In Relationships', text: 'Critical parent ‚Üí seeks critical partner. Familiar = "home." Fantasy: THIS time I\'ll get love.' }, { title: 'In Parenting', text: 'Despite vowing differently, repeat unless processed own pain.' }], questions: [{ question: 'Client chooses unavailable partners despite insight:', answers: [{ text: 'Bad judgment', correct: false, feedback: 'Unconscious compulsion!' }, { text: 'Unconscious recreation - must feel original pain', correct: true, feedback: 'Must feel grief/rage - not just understand.' }, { text: 'Just pick better', correct: false, feedback: 'Conscious limited when unconscious driving!' }, { text: 'That\'s all available', correct: false, feedback: 'Unconscious CREATES by attraction.' }] }, { question: 'Why feel original pain?', answers: [{ text: 'Punishment', correct: false, feedback: 'Healing necessity!' }, { text: 'Repressed feelings drive behavior until felt and grieved', correct: true, feedback: 'Only when FELT can it stop.' }, { text: 'Suffering builds character', correct: false, feedback: 'About feeling what was repressed.' }, { text: 'Pain prevents relationships', correct: false, feedback: 'Feeling pain FREES you.' }] }] }] },
            { id: 'enlightened-witness', title: 'Enlightened Witness', icon: 'üëÅÔ∏è', level: 2, xp: 35, prereq: 'compulsion-repeat', lessons: [{ title: 'Someone Who Sees', teaching: `ENLIGHTENED WITNESS: person who validates reality when parents couldn't.

Therapist, teacher, anyone saying "What happened was real, wrong, you deserved better."

Doesn't rescue. WITNESSES: acknowledges reality, validates feelings. Profoundly healing.`, concepts: [{ title: 'What Makes "Enlightened"', text: 'Done own work - processed pain, tolerates feelings. Therapist must be in own therapy.' }, { title: 'Power of Being Seen', text: 'Child never truly seen. Witness SEES them - revolutionary! "You exist. Your feelings matter."' }], questions: [{ question: 'Client: "Parents did their best." As witness:', answers: [{ text: 'Agree', correct: false, feedback: 'Colludes with defense!' }, { text: '"Parents had reasons AND you deserved better. Both truths?"', correct: true, feedback: 'Validate AND validate child deserved better.' }, { text: '"Parents were terrible"', correct: false, feedback: 'Not demonizing! Witnessing harm.' }, { text: 'Focus on resilience', correct: false, feedback: 'Bypasses grief.' }] }, { question: 'Why witness must have done own work?', answers: [{ text: 'Certification', correct: false, feedback: 'Capacity to truly see!' }, { text: 'Unprocessed pain distorts - may defend parents or over-identify', correct: true, feedback: 'Can only see what you\'ve acknowledged in yourself.' }, { text: 'Makes you smarter', correct: false, feedback: 'Cleared perception!' }, { text: 'Don\'t need to', correct: false, feedback: 'Miller emphatic!' }] }] }] },
            { id: 'reclaiming-self', title: 'Reclaiming True Self', icon: '‚ú®', level: 3, xp: 40, prereq: 'enlightened-witness', lessons: [{ title: 'Path to Authenticity', teaching: `Recovery: mourning what you didn't get, feeling forbidden feelings, discovering what you want.

Painful: acknowledge harm, feel grief, risk relationship with parents.

Only path to: living authentically, ending depression, breaking cycle.`, concepts: [{ title: 'Mourning', text: 'Grieve: childhood didn\'t have, seeing didn\'t get, parent who couldn\'t love. Can\'t skip grief.' }, { title: 'Finding Wants', text: 'False self knows what it SHOULD want. What do YOU want? May not know.' }], questions: [{ question: '"I\'ve forgiven parents, why depressed?" Miller says:', answers: [{ text: 'Forgiveness should work', correct: false, feedback: 'Warns against premature!' }, { text: 'Premature forgiveness bypasses rage/grief - must feel before forgiving', correct: true, feedback: 'True forgiveness AFTER fully feeling.' }, { text: 'Forgive harder', correct: false, feedback: 'More forgiveness = more repression.' }, { text: 'Forgiveness irrelevant', correct: false, feedback: 'May come - after feeling.' }] }, { question: '"Reclaiming true self" involves?', answers: [{ text: 'Becoming selfish', correct: false, feedback: 'Knowing own feelings/needs!' }, { text: 'Feeling repressed emotions, mourning losses, discovering wants', correct: true, feedback: 'Long process.' }, { text: 'Cutting off family', correct: false, feedback: 'Not prescribed. Living authentically.' }, { text: 'Returning to childhood', correct: false, feedback: 'Can\'t redo. Can grieve and live differently.' }] }, { question: 'Why only way to break cycle?', answers: [{ text: 'Parenting books enough', correct: false, feedback: 'Knowledge doesn\'t break cycle!' }, { text: 'Without feeling your pain, you\'ll repeat it with children', correct: true, feedback: 'Unprocessed pain transmits. Only YOUR work breaks it.' }, { text: 'Just decide differently', correct: false, feedback: 'Unconscious overrides!' }, { text: 'Children do therapy', correct: false, feedback: 'YOUR work needed.' }] }] }] }
        ];
        function initUI() { updateStats(); renderSkillGrid(); }
        function updateStats() { const xp = (gameState.xp / gameState.xpToNextLevel) * 100, m = Math.round((gameState.completedSkills.length / skillTree.length) * 100), p = gameState.level <= 1 ? 'FOUNDATIONS' : gameState.level <= 2 ? 'INTERMEDIATE' : 'ADVANCED'; document.getElementById('xp-bar').style.width = xp + '%'; document.getElementById('xp-text').textContent = `${gameState.xp} / ${gameState.xpToNextLevel} XP`; document.getElementById('level-display').textContent = gameState.level; document.getElementById('mastery-display').textContent = m + '%'; document.getElementById('streak-display').textContent = gameState.streak + 'üî•'; document.getElementById('current-path').textContent = p; }
        function renderSkillGrid() { const g = document.getElementById('skill-grid'); g.innerHTML = skillTree.map(s => { const c = gameState.completedSkills.includes(s.id), u = !s.prereq || gameState.completedSkills.includes(s.prereq); let st = 'üîí', cl = 'locked'; if (c) { st = '‚úì'; cl = 'completed'; } else if (u) { st = '‚Üí'; cl = 'unlocked'; } return `<div class="skill-card ${cl}" onclick="${u ? `startSkill('${s.id}')` : ''}" tabindex="${u ? '0' : '-1'}"><div class="skill-icon">${s.icon}</div><div class="skill-info"><div class="skill-title">${s.title}</div><div class="skill-meta"><span class="skill-xp">+${s.xp} XP</span><span>Lv ${s.level}</span></div></div><div class="skill-status">${st}</div></div>`; }).join(''); g.querySelectorAll('.skill-card.unlocked').forEach(c => c.onkeydown = e => { if (e.key === 'Enter') c.click(); }); }
        function startSkill(id) { const s = skillTree.find(x => x.id === id); if (!s) return; gameState.currentLesson = s; gameState.currentQuestion = 0; gameState.correctAnswers = 0; gameState.questionResults = []; showLesson(s); }
        function showLesson(s) { const m = document.getElementById('modal'), c = document.getElementById('modal-content'), l = s.lessons[0]; c.innerHTML = `<div class="lesson-header"><div class="lesson-icon">${s.icon}</div><h2 class="lesson-title">${l.title}</h2><div class="lesson-subtitle">+${s.xp} XP</div></div><div class="teaching-section"><div class="teaching-text">${l.teaching}</div></div><div>${l.concepts.map(x => `<div class="concept-card"><div class="concept-title">üìå ${x.title}</div><div class="concept-text">${x.text}</div></div>`).join('')}</div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal()">‚Üê Back</button><button class="btn btn-primary" onclick="startQuestions()">Start Quiz ‚Üí</button></div>`; m.classList.add('active'); document.body.style.overflow = 'hidden'; document.body.style.position = 'fixed'; document.body.style.width = '100%'; document.body.style.top = `-${window.scrollY}px`; }
        function startQuestions() { showQuestion(0); }
        function showQuestion(i) { const s = gameState.currentLesson, l = s.lessons[0], q = l.questions[i], c = document.getElementById('modal-content'), t = l.questions.length; const dots = l.questions.map((_, j) => `<div class="progress-dot${j === i ? ' current' : j < i ? (gameState.questionResults[j] ? ' correct' : ' incorrect') : ''}"></div>`).join(''); c.innerHTML = `<div class="lesson-header"><h2 class="lesson-title">${s.title}</h2><div class="lesson-subtitle">Q${i + 1}/${t}</div></div><div class="question-progress"><div class="progress-dots">${dots}</div>${i > 0 ? `<span class="score-display"><span class="score-value">${gameState.correctAnswers}/${i}</span></span>` : ''}</div><div class="question-text">${q.question}</div><div class="answers-list">${q.answers.map((a, j) => `<button class="answer-btn" onclick="selectAnswer(${j})">${a.text}</button>`).join('')}</div><div class="feedback-box" id="feedback"></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal()">‚Üê Exit</button><div id="cont"></div></div>`; window.qData = { q, i, t }; }
        function selectAnswer(j) { const { q, i, t } = window.qData, a = q.answers[j], btns = document.querySelectorAll('.answer-btn'), fb = document.getElementById('feedback'), ct = document.getElementById('cont'); btns.forEach(b => b.classList.add('disabled')); if (a.correct) { btns[j].classList.add('correct'); fb.className = 'feedback-box correct show'; fb.innerHTML = '‚úì ' + a.feedback; gameState.correctAnswers++; gameState.questionResults.push(true); } else { btns[j].classList.add('incorrect'); fb.className = 'feedback-box incorrect show'; fb.innerHTML = '‚úó ' + a.feedback; gameState.questionResults.push(false); } ct.innerHTML = `<button class="btn btn-primary" onclick="${i >= t - 1 ? 'completeSkill()' : 'nextQuestion()'}">${i >= t - 1 ? 'Results ‚Üí' : 'Continue ‚Üí'}</button>`; }
        function nextQuestion() { gameState.currentQuestion++; showQuestion(gameState.currentQuestion); }
        function completeSkill() { const s = gameState.currentLesson, t = s.lessons[0].questions.length, sc = Math.round((gameState.correctAnswers / t) * 100), xp = s.xp; gameState.xp += xp; gameState.totalXp += xp; while (gameState.xp >= gameState.xpToNextLevel) { gameState.xp -= gameState.xpToNextLevel; gameState.level++; gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5); } if (!gameState.completedSkills.includes(s.id)) { gameState.completedSkills.push(s.id); gameState.streak++; } const nx = skillTree.slice(skillTree.findIndex(x => x.id === s.id) + 1).find(x => !x.prereq || gameState.completedSkills.includes(x.prereq)); const c = document.getElementById('modal-content'); c.innerHTML = `<div class="completion-screen"><div class="completion-icon">${s.icon}</div><h2 class="completion-title">MASTERED!</h2><div class="completion-xp">+${xp} XP</div><div class="completion-stats"><p>Score: <span style="color:var(--secondary)">${sc}%</span></p><p>${s.title}</p></div></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModalAndRefresh()">‚Üê Skills</button>${nx && !gameState.completedSkills.includes(nx.id) ? `<button class="btn btn-accent" onclick="startNextSkill('${nx.id}')">Next ‚Üí</button>` : ''}</div>`; if (typeof confetti !== 'undefined') confetti({ particleCount: 80, spread: 60, origin: { y: 0.7 }, colors: ['#fa0', '#fc0'] }); saveProgress(); }
        function startNextSkill(id) { closeModal(); setTimeout(() => startSkill(id), 200); }
        function closeModal() { const y = document.body.style.top; document.getElementById('modal').classList.remove('active'); document.body.style.overflow = ''; document.body.style.position = ''; document.body.style.width = ''; document.body.style.top = ''; window.scrollTo(0, parseInt(y || '0') * -1); }
        function closeModalAndRefresh() { closeModal(); updateStats(); renderSkillGrid(); }
        function saveProgress() { localStorage.setItem('giftedChildAcademy', JSON.stringify(gameState)); showToast('üíæ Saved!'); }
        function loadProgress() { const s = localStorage.getItem('giftedChildAcademy'); if (s) { gameState = JSON.parse(s); updateStats(); renderSkillGrid(); showToast('‚úì Loaded!'); } else showToast('No save found'); }
        function resetProgress() { if (confirm('Reset progress?')) { localStorage.removeItem('giftedChildAcademy'); location.reload(); } }
        function showToast(m) { const t = document.getElementById('toast'); t.textContent = m; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000); }
        function goHome() { window.location.href = 'learning-library-hub.html'; }
        document.addEventListener('keydown', e => { const m = document.getElementById('modal'), o = m.classList.contains('active'); if (e.key === 'Escape' && o) closeModal(); if (!o && e.key === 'h') goHome(); if (!o && e.key === 's') { e.preventDefault(); saveProgress(); } });
        document.addEventListener('DOMContentLoaded', () => { const s = localStorage.getItem('giftedChildAcademy'); if (s) gameState = JSON.parse(s); initUI(); });
    </script>
</body>
</html>
